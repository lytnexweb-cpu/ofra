<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Maquette 11 — Permissions & Rôles</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwindcss.config = {
      theme: {
        extend: {
          colors: { primary: '#1e3a5f', accent: '#e07a2f' },
          fontFamily: { outfit: ['Outfit', 'system-ui', 'sans-serif'] },
        },
      },
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    .viewport-btn.active { background: #1e3a5f; color: white; }
    .viewport-frame { transition: width 0.4s ease, max-width 0.4s ease; margin: 0 auto; overflow: hidden; }
    .overlay { background: rgba(0,0,0,0.5); backdrop-filter: blur(2px); overflow-y: auto; }
    .modal-enter {
      animation: modalIn 0.2s ease-out;
      display: flex; flex-direction: column; max-height: calc(100% - 2rem);
    }
    .modal-body { overflow-y: auto; flex: 1; min-height: 0; }
    @keyframes modalIn { from { opacity:0; transform: scale(0.95) translateY(8px); } to { opacity:1; transform: scale(1) translateY(0); } }
    .mobile-mode { overflow-y: auto !important; }
    .mobile-mode .overlay { align-items: flex-end; padding: 0; }
    .mobile-mode .modal-enter { max-width:100%; border-radius:1rem 1rem 0 0; max-height:92%; animation: sheetUp 0.25s ease-out; }
    .mobile-mode .mobile-handle { display: flex; }
    .mobile-mode .modal-header { padding-top: 0.75rem; }
    @keyframes sheetUp { from { opacity:0; transform: translateY(100%); } to { opacity:1; transform: translateY(0); } }
    .state-section { display: none; }
    .state-section.active { display: block; }
    .state-btn.active { background: #1e3a5f; color: white; }
    .viewport-frame-scrollable { overflow-y: auto !important; }

    .toggle-track { width: 36px; height: 20px; border-radius: 10px; background: #d6d3d1; transition: background 0.2s; position: relative; cursor: pointer; }
    .toggle-track.on { background: #1e3a5f; }
    .toggle-dot { width: 16px; height: 16px; border-radius: 50%; background: white; position: absolute; top: 2px; left: 2px; transition: transform 0.2s; box-shadow: 0 1px 3px rgba(0,0,0,0.15); }
    .toggle-track.on .toggle-dot { transform: translateX(16px); }

    @keyframes toastIn { from { opacity:0; transform: translateY(-12px); } to { opacity:1; transform: translateY(0); } }
    .toast-enter { animation: toastIn 0.3s ease-out; }

    .user-row { transition: background 0.1s; }
    .user-row:hover { background: #fafaf9; }

    .role-badge { font-size: 10px; padding: 2px 8px; border-radius: 9999px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.03em; }

    .tooltip-wrapper { position: relative; }
    .tooltip-wrapper .tooltip-text {
      visibility:hidden; opacity:0; position:absolute; bottom:calc(100% + 6px); left:50%;
      transform:translateX(-50%); background:#1e293b; color:white; padding:4px 10px;
      border-radius:6px; font-size:11px; white-space:nowrap; transition:opacity 0.2s; z-index:50;
    }
    .tooltip-wrapper:hover .tooltip-text { visibility:visible; opacity:1; }

    /* ===== MOBILE MODE OVERRIDES ===== */
    .mobile-mode .page-pad { padding-left: 0.75rem !important; padding-right: 0.75rem !important; }
    .mobile-mode .section-card { padding: 0.75rem !important; }
    .mobile-mode .header-row { flex-direction: column; gap: 0.5rem; }
    .mobile-mode .header-icon { display: none !important; }
    .mobile-mode .header-subtitle .desktop-only { display: none !important; }
    .mobile-mode .user-row-inner { flex-direction: column; align-items: flex-start !important; gap: 0.5rem !important; }
    .mobile-mode .user-controls { width: 100%; justify-content: space-between; }
    .mobile-mode .user-email { display: none; }
    .mobile-mode .matrix-grid { grid-template-columns: 1fr !important; }
    .mobile-mode .matrix-row { grid-template-columns: 1fr 1fr !important; }
    .mobile-mode .public-link-grid { grid-template-columns: 1fr !important; }
    .mobile-mode .expiry-grid { grid-template-columns: repeat(2, 1fr) !important; }
    .mobile-mode .toast-enter { left: 0.75rem; right: 0.75rem; transform: none; max-width: none; text-align: center; }
    .mobile-mode .toast-enter span { font-size: 12px; }
  </style>
</head>
<body class="bg-stone-200 min-h-screen">

  <!-- VIEWPORT SWITCHER -->
  <div class="fixed top-0 left-0 right-0 bg-stone-800 text-white z-[100] shadow-lg">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <span class="text-sm font-bold font-outfit">MAQUETTE 11</span>
        <span class="text-xs text-stone-400">Permissions & Rôles</span>
      </div>
      <div class="flex items-center gap-2">
        <button onclick="setViewport('mobile')" id="btn-mobile" class="viewport-btn px-3 py-1.5 rounded-lg text-xs font-medium bg-stone-700 hover:bg-stone-600 transition-colors">Mobile (375px)</button>
        <button onclick="setViewport('tablet')" id="btn-tablet" class="viewport-btn px-3 py-1.5 rounded-lg text-xs font-medium bg-stone-700 hover:bg-stone-600 transition-colors">Tablette (768px)</button>
        <button onclick="setViewport('desktop')" id="btn-desktop" class="viewport-btn active px-3 py-1.5 rounded-lg text-xs font-medium bg-stone-700 hover:bg-stone-600 transition-colors">Desktop (1280px)</button>
      </div>
      <div class="text-xs text-stone-400">Gestion des accès</div>
    </div>
  </div>

  <!-- STATE SWITCHER -->
  <div class="fixed top-[52px] left-0 right-0 bg-stone-700 text-white z-[99] border-t border-stone-600">
    <div class="max-w-7xl mx-auto px-4 py-2 flex items-center gap-2 flex-wrap">
      <span class="text-xs text-stone-400 font-medium">ETAT :</span>
      <button onclick="showState('list')" id="state-list" class="state-btn active px-2.5 py-1 rounded-md text-xs font-medium bg-stone-600 hover:bg-stone-500 transition-colors">A — Liste</button>
      <button onclick="showState('invite')" id="state-invite" class="state-btn px-2.5 py-1 rounded-md text-xs font-medium bg-stone-600 hover:bg-stone-500 transition-colors">B — Inviter</button>
      <button onclick="showState('pending')" id="state-pending" class="state-btn px-2.5 py-1 rounded-md text-xs font-medium bg-stone-600 hover:bg-stone-500 transition-colors">C — Invitation envoyée</button>
      <button onclick="showState('role-change')" id="state-role-change" class="state-btn px-2.5 py-1 rounded-md text-xs font-medium bg-stone-600 hover:bg-stone-500 transition-colors">D — Changement rôle</button>
      <button onclick="showState('remove')" id="state-remove" class="state-btn px-2.5 py-1 rounded-md text-xs font-medium bg-stone-600 hover:bg-stone-500 transition-colors">E — Retrait accès</button>
      <button onclick="showState('error')" id="state-error" class="state-btn px-2.5 py-1 rounded-md text-xs font-medium bg-stone-600 hover:bg-stone-500 transition-colors">F — Erreur permission</button>
    </div>
  </div>

  <!-- ============================================== -->
  <!-- STATE A — Liste normale                         -->
  <!-- ============================================== -->
  <div id="state-list-section" class="state-section active pt-28 pb-8 px-4">
    <div id="viewport-frame-a" class="viewport-frame viewport-frame-scrollable bg-white shadow-2xl rounded-xl border border-stone-300" style="width:100%; max-width:1280px; max-height:85vh;">
      <div class="bg-stone-50 min-h-[80vh]">

        <!-- Page header -->
        <div class="bg-white border-b border-stone-200 px-4 sm:px-6 lg:px-8 py-4 page-pad">
          <div class="max-w-4xl mx-auto">
            <div class="flex items-center gap-1.5 text-xs text-stone-400 mb-3 overflow-hidden">
              <span class="hover:text-stone-600 cursor-pointer flex-shrink-0">Transactions</span>
              <svg class="w-3 h-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
              <span class="hover:text-stone-600 cursor-pointer truncate">Marie-Claire Dupont</span>
              <svg class="w-3 h-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
              <span class="text-stone-600 font-medium flex-shrink-0">Accès</span>
            </div>
            <div class="header-row flex items-start justify-between gap-2">
              <div class="flex items-center gap-3">
                <div class="header-icon w-9 h-9 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0">
                  <svg class="w-4.5 h-4.5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                </div>
                <div class="min-w-0">
                  <h1 class="text-base sm:text-lg font-bold text-stone-900 font-outfit">Accès & Permissions</h1>
                  <div class="header-subtitle flex flex-wrap items-center gap-x-2 gap-y-0.5 mt-0.5">
                    <span class="text-xs text-stone-500 truncate">Marie-Claire Dupont</span>
                    <span class="desktop-only text-stone-300">·</span>
                    <span class="desktop-only text-xs text-stone-500">125 rue Principale</span>
                    <span class="inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-medium bg-emerald-100 text-emerald-700">Active</span>
                    <span class="inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-medium bg-primary/10 text-primary">{N} membres</span>
                  </div>
                </div>
              </div>
              <button class="px-3 py-2 text-xs font-medium text-white bg-primary hover:bg-primary/90 rounded-lg shadow-sm flex items-center gap-1.5 flex-shrink-0">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg>
                Inviter
              </button>
            </div>
          </div>
        </div>

        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6 page-pad">

          <!-- Users list -->
          <div class="bg-white rounded-xl border border-stone-200 shadow-sm mb-5">
            <div class="px-5 py-3 border-b border-stone-100">
              <h3 class="text-xs font-semibold text-stone-500 uppercase tracking-wide">Accès à la transaction</h3>
            </div>

            <!-- User 1: Owner (vous) -->
            <div class="user-row px-5 py-3 border-b border-stone-100">
              <div class="user-row-inner flex items-center justify-between gap-3">
                <div class="flex items-center gap-3 min-w-0">
                  <div class="w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center text-xs font-bold flex-shrink-0">LT</div>
                  <div class="min-w-0">
                    <div class="flex items-center gap-2">
                      <p class="text-sm font-medium text-stone-900 truncate">Luc Tremblay</p>
                      <span class="role-badge bg-primary/10 text-primary">Owner</span>
                      <span class="text-[10px] text-stone-400">(vous)</span>
                    </div>
                    <p class="user-email text-xs text-stone-400 truncate">l.tremblay@remax.ca</p>
                  </div>
                </div>
                <div class="user-controls flex items-center gap-2 flex-shrink-0">
                  <span class="text-[10px] text-emerald-600 font-medium flex items-center gap-1">
                    <span class="w-1.5 h-1.5 rounded-full bg-emerald-500"></span>Actif
                  </span>
                  <div class="tooltip-wrapper">
                    <button class="p-1.5 text-stone-300 cursor-not-allowed" disabled>
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"/></svg>
                    </button>
                    <span class="tooltip-text">Impossible de modifier le Owner</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- User 2: Admin -->
            <div class="user-row px-5 py-3 border-b border-stone-100">
              <div class="user-row-inner flex items-center justify-between gap-3">
                <div class="flex items-center gap-3 min-w-0">
                  <div class="w-8 h-8 rounded-full bg-accent/20 text-accent flex items-center justify-center text-xs font-bold flex-shrink-0">SL</div>
                  <div class="min-w-0">
                    <div class="flex items-center gap-2">
                      <p class="text-sm font-medium text-stone-900 truncate">Sophie Leblanc</p>
                      <span class="role-badge bg-amber-100 text-amber-700">Admin</span>
                    </div>
                    <p class="user-email text-xs text-stone-400 truncate">s.leblanc@cabinet.ca</p>
                  </div>
                </div>
                <div class="user-controls flex items-center gap-2 flex-shrink-0">
                  <span class="text-[10px] text-emerald-600 font-medium flex items-center gap-1">
                    <span class="w-1.5 h-1.5 rounded-full bg-emerald-500"></span>Actif
                  </span>
                  <select class="text-xs border border-stone-200 rounded-lg px-2 py-1 outline-none bg-white cursor-pointer">
                    <option>Admin</option>
                    <option>Editor</option>
                    <option>Viewer</option>
                  </select>
                  <button class="p-1.5 text-stone-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                  </button>
                </div>
              </div>
            </div>

            <!-- User 3: Editor -->
            <div class="user-row px-5 py-3 border-b border-stone-100">
              <div class="user-row-inner flex items-center justify-between gap-3">
                <div class="flex items-center gap-3 min-w-0">
                  <div class="w-8 h-8 rounded-full bg-emerald-100 text-emerald-700 flex items-center justify-center text-xs font-bold flex-shrink-0">MC</div>
                  <div class="min-w-0">
                    <div class="flex items-center gap-2">
                      <p class="text-sm font-medium text-stone-900 truncate">Marie-Claire Dupont</p>
                      <span class="role-badge bg-blue-100 text-blue-700">Editor</span>
                    </div>
                    <p class="user-email text-xs text-stone-400 truncate">mc.dupont@email.com</p>
                  </div>
                </div>
                <div class="user-controls flex items-center gap-2 flex-shrink-0">
                  <span class="text-[10px] text-emerald-600 font-medium flex items-center gap-1">
                    <span class="w-1.5 h-1.5 rounded-full bg-emerald-500"></span>Actif
                  </span>
                  <select class="text-xs border border-stone-200 rounded-lg px-2 py-1 outline-none bg-white cursor-pointer">
                    <option>Admin</option>
                    <option selected>Editor</option>
                    <option>Viewer</option>
                  </select>
                  <button class="p-1.5 text-stone-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                  </button>
                </div>
              </div>
            </div>

            <!-- User 4: Viewer (pending) -->
            <div class="user-row px-5 py-3">
              <div class="user-row-inner flex items-center justify-between gap-3">
                <div class="flex items-center gap-3 min-w-0">
                  <div class="w-8 h-8 rounded-full bg-stone-200 text-stone-500 flex items-center justify-center text-xs font-bold flex-shrink-0">JP</div>
                  <div class="min-w-0">
                    <div class="flex items-center gap-2">
                      <p class="text-sm font-medium text-stone-500 truncate">jp.martin@email.com</p>
                      <span class="role-badge bg-stone-100 text-stone-500">Viewer</span>
                    </div>
                    <p class="user-email text-xs text-stone-400 truncate flex items-center gap-1">
                      <svg class="w-3 h-3 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                      Invitation envoyée il y a 2 jours
                    </p>
                  </div>
                </div>
                <div class="user-controls flex items-center gap-2 flex-shrink-0">
                  <span class="text-[10px] text-amber-600 font-medium flex items-center gap-1">
                    <span class="w-1.5 h-1.5 rounded-full bg-amber-400"></span>Pending
                  </span>
                  <button class="text-[10px] text-primary font-medium hover:underline">Renvoyer</button>
                  <button class="p-1.5 text-stone-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Public link toggle -->
          <div class="bg-white rounded-xl border border-stone-200 shadow-sm p-5 section-card mb-5">
            <div class="flex items-center justify-between mb-3">
              <div class="flex items-center gap-2.5">
                <div class="w-8 h-8 rounded-lg bg-blue-50 flex items-center justify-center flex-shrink-0">
                  <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/></svg>
                </div>
                <div>
                  <h3 class="text-sm font-semibold text-stone-900 font-outfit">Lien public</h3>
                  <p class="text-[10px] text-stone-400">Accès sans compte · Configurable via Exporter & Partager</p>
                </div>
              </div>
              <div class="toggle-track" onclick="this.classList.toggle('on')">
                <div class="toggle-dot"></div>
              </div>
            </div>
            <div class="rounded-lg bg-stone-50 border border-stone-100 p-3">
              <p class="text-xs text-stone-500 flex items-center gap-1.5">
                <svg class="w-3.5 h-3.5 text-stone-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                Aucun lien actif. Activez pour configurer rôle, expiration et mot de passe.
              </p>
            </div>
          </div>

          <!-- Permissions matrix -->
          <div class="bg-white rounded-xl border border-stone-200 shadow-sm p-5 section-card">
            <h3 class="text-xs font-semibold text-stone-500 uppercase tracking-wide mb-4">Matrice des permissions</h3>
            <div class="overflow-x-auto">
              <table class="w-full text-xs">
                <thead>
                  <tr class="border-b border-stone-200">
                    <th class="text-left py-2 pr-4 font-semibold text-stone-600 min-w-[140px]">Action</th>
                    <th class="text-center py-2 px-2 font-semibold text-stone-400 w-16">Viewer</th>
                    <th class="text-center py-2 px-2 font-semibold text-blue-600 w-16">Editor</th>
                    <th class="text-center py-2 px-2 font-semibold text-amber-600 w-16">Admin</th>
                    <th class="text-center py-2 px-2 font-semibold text-primary w-16">Owner</th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-stone-100">
                  <tr>
                    <td class="py-2 pr-4 text-stone-700">Voir la transaction</td>
                    <td class="text-center py-2"><svg class="w-4 h-4 text-emerald-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg></td>
                    <td class="text-center py-2"><svg class="w-4 h-4 text-emerald-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg></td>
                    <td class="text-center py-2"><svg class="w-4 h-4 text-emerald-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg></td>
                    <td class="text-center py-2"><svg class="w-4 h-4 text-emerald-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg></td>
                  </tr>
                  <tr>
                    <td class="py-2 pr-4 text-stone-700">Modifier offres / conditions</td>
                    <td class="text-center py-2"><svg class="w-4 h-4 text-stone-300 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></td>
                    <td class="text-center py-2"><svg class="w-4 h-4 text-emerald-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg></td>
                    <td class="text-center py-2"><svg class="w-4 h-4 text-emerald-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg></td>
                    <td class="text-center py-2"><svg class="w-4 h-4 text-emerald-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg></td>
                  </tr>
                  <tr>
                    <td class="py-2 pr-4 text-stone-700">Gérer documents</td>
                    <td class="text-center py-2"><svg class="w-4 h-4 text-stone-300 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></td>
                    <td class="text-center py-2"><svg class="w-4 h-4 text-emerald-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg></td>
                    <td class="text-center py-2"><svg class="w-4 h-4 text-emerald-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg></td>
                    <td class="text-center py-2"><svg class="w-4 h-4 text-emerald-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg></td>
                  </tr>
                  <tr>
                    <td class="py-2 pr-4 text-stone-700">Annuler / Archiver</td>
                    <td class="text-center py-2"><svg class="w-4 h-4 text-stone-300 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></td>
                    <td class="text-center py-2"><svg class="w-4 h-4 text-stone-300 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></td>
                    <td class="text-center py-2"><svg class="w-4 h-4 text-emerald-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg></td>
                    <td class="text-center py-2"><svg class="w-4 h-4 text-emerald-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg></td>
                  </tr>
                  <tr>
                    <td class="py-2 pr-4 text-stone-700">Gérer les accès</td>
                    <td class="text-center py-2"><svg class="w-4 h-4 text-stone-300 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></td>
                    <td class="text-center py-2"><svg class="w-4 h-4 text-stone-300 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></td>
                    <td class="text-center py-2"><svg class="w-4 h-4 text-emerald-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg></td>
                    <td class="text-center py-2"><svg class="w-4 h-4 text-emerald-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg></td>
                  </tr>
                  <tr>
                    <td class="py-2 pr-4 text-stone-700">Supprimer la transaction</td>
                    <td class="text-center py-2"><svg class="w-4 h-4 text-stone-300 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></td>
                    <td class="text-center py-2"><svg class="w-4 h-4 text-stone-300 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></td>
                    <td class="text-center py-2"><svg class="w-4 h-4 text-stone-300 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></td>
                    <td class="text-center py-2"><svg class="w-4 h-4 text-emerald-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg></td>
                  </tr>
                  <tr>
                    <td class="py-2 pr-4 text-stone-700">Transférer la propriété</td>
                    <td class="text-center py-2"><svg class="w-4 h-4 text-stone-300 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></td>
                    <td class="text-center py-2"><svg class="w-4 h-4 text-stone-300 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></td>
                    <td class="text-center py-2"><svg class="w-4 h-4 text-stone-300 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></td>
                    <td class="text-center py-2"><svg class="w-4 h-4 text-emerald-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- ============================================== -->
  <!-- STATE B — Modal inviter                         -->
  <!-- ============================================== -->
  <div id="state-invite-section" class="state-section pt-28 pb-8 px-4">
    <div id="viewport-frame-b" class="viewport-frame bg-stone-100 shadow-2xl rounded-xl border border-stone-300 relative" style="width:100%; max-width:1280px; height:80vh;">
      <div class="overlay absolute inset-0 flex items-center justify-center p-4 z-10">
        <div class="modal-enter bg-white rounded-2xl shadow-2xl w-full max-w-md">
          <div class="mobile-handle hidden justify-center pt-3 pb-1"><div class="w-8 h-1 rounded-full bg-stone-300"></div></div>
          <div class="modal-header px-5 pt-5 pb-3 border-b border-stone-100">
            <div class="flex items-center gap-3">
              <div class="w-9 h-9 rounded-full bg-primary/10 flex items-center justify-center">
                <svg class="w-4.5 h-4.5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg>
              </div>
              <div>
                <h3 class="text-sm font-bold text-stone-900 font-outfit">Inviter un collaborateur</h3>
                <p class="text-xs text-stone-500">Donner accès à cette transaction</p>
              </div>
            </div>
          </div>
          <div class="modal-body px-5 py-4 space-y-4">
            <!-- Email -->
            <div>
              <label class="block text-xs font-medium text-stone-600 mb-1">Courriel <span class="text-red-400">*</span></label>
              <input type="email" id="invite-email" oninput="updateInviteCta()" placeholder="nom@exemple.com" class="w-full px-3 py-2 text-sm border border-stone-300 rounded-lg outline-none placeholder:text-stone-300 focus:ring-2 focus:ring-primary/20 focus:border-primary">
            </div>
            <!-- Rôle -->
            <div>
              <label class="block text-xs font-medium text-stone-600 mb-1">Rôle</label>
              <div class="grid grid-cols-3 gap-2">
                <div class="radio-card text-center cursor-pointer" onclick="selectInviteRole(this)">
                  <p class="text-[11px] font-medium text-stone-700">Viewer</p>
                  <p class="text-[9px] text-stone-400 mt-0.5">Lecture seule</p>
                </div>
                <div class="radio-card selected text-center cursor-pointer" onclick="selectInviteRole(this)">
                  <p class="text-[11px] font-medium text-stone-700">Editor</p>
                  <p class="text-[9px] text-stone-400 mt-0.5">Modifier</p>
                </div>
                <div class="radio-card text-center cursor-pointer" onclick="selectInviteRole(this)">
                  <p class="text-[11px] font-medium text-stone-700">Admin</p>
                  <p class="text-[9px] text-stone-400 mt-0.5">Gérer</p>
                </div>
              </div>
            </div>
            <!-- Message -->
            <div>
              <label class="block text-xs font-medium text-stone-600 mb-1">Message <span class="text-stone-400 font-normal">(optionnel)</span></label>
              <textarea rows="2" class="w-full px-3 py-2 text-sm border border-stone-300 rounded-lg outline-none resize-none placeholder:text-stone-300" placeholder="Message personnalisé pour l'invitation..."></textarea>
            </div>
          </div>
          <div class="px-5 py-4 border-t border-stone-100 flex items-center justify-end gap-2">
            <button class="px-3 py-2 text-xs font-medium text-stone-600 bg-white border border-stone-300 rounded-lg hover:bg-stone-50">Annuler</button>
            <button id="invite-send-btn" class="px-4 py-2 text-xs font-medium text-white rounded-lg shadow-sm bg-stone-300 cursor-not-allowed flex items-center gap-1.5" disabled>
              <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>
              Envoyer l'invitation
            </button>
          </div>
        </div>
      </div>
      <div class="absolute inset-0 bg-stone-50 opacity-50 p-8"><div class="max-w-4xl mx-auto"><div class="h-6 bg-stone-200 rounded w-48 mb-4"></div><div class="h-40 bg-stone-200 rounded w-full mb-3"></div><div class="h-24 bg-stone-200 rounded w-full"></div></div></div>
    </div>
  </div>

  <!-- ============================================== -->
  <!-- STATE C — Invitation envoyée (pending)          -->
  <!-- ============================================== -->
  <div id="state-pending-section" class="state-section pt-28 pb-8 px-4">
    <div id="viewport-frame-c" class="viewport-frame bg-stone-100 shadow-2xl rounded-xl border border-stone-300 relative" style="width:100%; max-width:1280px; height:80vh;">
      <div class="overlay absolute inset-0 flex items-center justify-center p-4 z-10">
        <div class="modal-enter bg-white rounded-2xl shadow-2xl w-full max-w-sm">
          <div class="mobile-handle hidden justify-center pt-3 pb-1"><div class="w-8 h-1 rounded-full bg-stone-300"></div></div>
          <div class="p-6 text-center">
            <div class="w-14 h-14 rounded-full bg-emerald-100 flex items-center justify-center mx-auto mb-4">
              <svg class="w-7 h-7 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
            </div>
            <h3 class="text-sm font-bold text-stone-900 font-outfit mb-1">Invitation envoyée</h3>
            <p class="text-xs text-stone-500 mb-4">Un courriel a été envoyé à l'adresse indiquée</p>
            <div class="rounded-lg bg-stone-50 border border-stone-200 p-3 text-left mb-4">
              <div class="space-y-1.5">
                <div class="flex items-center justify-between text-xs">
                  <span class="text-stone-500">Courriel</span>
                  <span class="font-medium text-stone-700">nouveau@exemple.com</span>
                </div>
                <div class="flex items-center justify-between text-xs">
                  <span class="text-stone-500">Rôle</span>
                  <span class="role-badge bg-blue-100 text-blue-700">Editor</span>
                </div>
                <div class="flex items-center justify-between text-xs">
                  <span class="text-stone-500">Statut</span>
                  <span class="text-amber-600 font-medium flex items-center gap-1"><span class="w-1.5 h-1.5 rounded-full bg-amber-400"></span>Pending</span>
                </div>
              </div>
            </div>
            <p class="text-[10px] text-stone-400 mb-4">L'utilisateur apparaîtra dans la liste une fois qu'il aura accepté l'invitation.</p>
            <button class="w-full px-4 py-2.5 text-xs font-medium text-primary bg-white border border-stone-300 rounded-lg hover:bg-stone-50">Fermer</button>
          </div>
        </div>
      </div>
      <div class="absolute inset-0 bg-stone-50 opacity-50 p-8"><div class="max-w-4xl mx-auto"><div class="h-6 bg-stone-200 rounded w-48 mb-4"></div><div class="h-40 bg-stone-200 rounded w-full"></div></div></div>
    </div>
  </div>

  <!-- ============================================== -->
  <!-- STATE D — Changement de rôle (toast + log)      -->
  <!-- ============================================== -->
  <div id="state-role-change-section" class="state-section pt-28 pb-8 px-4">
    <div id="viewport-frame-d" class="viewport-frame viewport-frame-scrollable bg-white shadow-2xl rounded-xl border border-stone-300" style="width:100%; max-width:1280px; max-height:85vh;">
      <div class="bg-stone-50 min-h-[80vh] relative">

        <!-- Toast -->
        <div class="toast-enter absolute top-4 left-1/2 -translate-x-1/2 z-50 bg-emerald-600 text-white px-4 py-3 rounded-xl shadow-lg flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
          <span class="text-sm font-medium">Rôle de Sophie Leblanc modifié → Editor</span>
        </div>

        <!-- Same header -->
        <div class="bg-white border-b border-stone-200 px-4 sm:px-6 lg:px-8 py-4 page-pad">
          <div class="max-w-4xl mx-auto">
            <h1 class="text-base sm:text-lg font-bold text-stone-900 font-outfit">Accès & Permissions</h1>
          </div>
        </div>

        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6 page-pad">
          <!-- Users list with highlighted change -->
          <div class="bg-white rounded-xl border border-stone-200 shadow-sm mb-5">
            <div class="px-5 py-3 border-b border-stone-100">
              <h3 class="text-xs font-semibold text-stone-500 uppercase tracking-wide">Accès à la transaction</h3>
            </div>
            <!-- Owner -->
            <div class="user-row px-5 py-3 border-b border-stone-100">
              <div class="user-row-inner flex items-center justify-between gap-3">
                <div class="flex items-center gap-3"><div class="w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center text-xs font-bold flex-shrink-0">LT</div><div><div class="flex items-center gap-2"><p class="text-sm font-medium text-stone-900">Luc Tremblay</p><span class="role-badge bg-primary/10 text-primary">Owner</span></div></div></div>
                <span class="text-[10px] text-emerald-600 font-medium flex items-center gap-1"><span class="w-1.5 h-1.5 rounded-full bg-emerald-500"></span>Actif</span>
              </div>
            </div>
            <!-- Sophie: changed from Admin to Editor (highlighted) -->
            <div class="user-row px-5 py-3 border-b border-stone-100 bg-amber-50/50">
              <div class="user-row-inner flex items-center justify-between gap-3">
                <div class="flex items-center gap-3 min-w-0">
                  <div class="w-8 h-8 rounded-full bg-accent/20 text-accent flex items-center justify-center text-xs font-bold flex-shrink-0">SL</div>
                  <div class="min-w-0">
                    <div class="flex items-center gap-2">
                      <p class="text-sm font-medium text-stone-900 truncate">Sophie Leblanc</p>
                      <span class="role-badge bg-blue-100 text-blue-700">Editor</span>
                      <span class="text-[10px] text-amber-600 flex items-center gap-1">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/></svg>
                        était Admin
                      </span>
                    </div>
                    <p class="user-email text-xs text-stone-400 truncate">s.leblanc@cabinet.ca</p>
                  </div>
                </div>
                <div class="user-controls flex items-center gap-2 flex-shrink-0">
                  <span class="text-[10px] text-emerald-600 font-medium flex items-center gap-1"><span class="w-1.5 h-1.5 rounded-full bg-emerald-500"></span>Actif</span>
                  <select class="text-xs border border-amber-300 bg-amber-50 rounded-lg px-2 py-1 outline-none cursor-pointer"><option>Admin</option><option selected>Editor</option><option>Viewer</option></select>
                </div>
              </div>
            </div>
            <!-- Marie-Claire -->
            <div class="user-row px-5 py-3">
              <div class="user-row-inner flex items-center justify-between gap-3">
                <div class="flex items-center gap-3"><div class="w-8 h-8 rounded-full bg-emerald-100 text-emerald-700 flex items-center justify-center text-xs font-bold flex-shrink-0">MC</div><div><div class="flex items-center gap-2"><p class="text-sm font-medium text-stone-900">Marie-Claire Dupont</p><span class="role-badge bg-blue-100 text-blue-700">Editor</span></div></div></div>
                <span class="text-[10px] text-emerald-600 font-medium flex items-center gap-1"><span class="w-1.5 h-1.5 rounded-full bg-emerald-500"></span>Actif</span>
              </div>
            </div>
          </div>

          <!-- Activity log -->
          <div class="bg-white rounded-xl border border-stone-200 shadow-sm p-5 section-card">
            <h3 class="text-xs font-semibold text-stone-500 uppercase tracking-wide mb-3">Journal des accès (récent)</h3>
            <div class="space-y-2">
              <div class="flex items-start gap-2.5 text-xs">
                <div class="w-5 h-5 rounded-full bg-amber-100 flex items-center justify-center flex-shrink-0 mt-0.5">
                  <svg class="w-3 h-3 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
                </div>
                <div>
                  <p class="text-stone-700"><strong>Luc Tremblay</strong> a modifié le rôle de <strong>Sophie Leblanc</strong> : Admin → Editor</p>
                  <p class="text-[10px] text-stone-400 mt-0.5">Il y a 2 minutes</p>
                </div>
              </div>
              <div class="flex items-start gap-2.5 text-xs">
                <div class="w-5 h-5 rounded-full bg-emerald-100 flex items-center justify-center flex-shrink-0 mt-0.5">
                  <svg class="w-3 h-3 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg>
                </div>
                <div>
                  <p class="text-stone-700"><strong>Luc Tremblay</strong> a invité <strong>jp.martin@email.com</strong> en tant que Viewer</p>
                  <p class="text-[10px] text-stone-400 mt-0.5">Il y a 2 jours</p>
                </div>
              </div>
              <div class="flex items-start gap-2.5 text-xs">
                <div class="w-5 h-5 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 mt-0.5">
                  <svg class="w-3 h-3 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                </div>
                <div>
                  <p class="text-stone-700"><strong>Sophie Leblanc</strong> a accepté l'invitation</p>
                  <p class="text-[10px] text-stone-400 mt-0.5">Il y a 5 jours</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ============================================== -->
  <!-- STATE E — Retrait accès (confirm + succès)      -->
  <!-- ============================================== -->
  <div id="state-remove-section" class="state-section pt-28 pb-8 px-4">
    <div id="viewport-frame-e" class="viewport-frame bg-stone-100 shadow-2xl rounded-xl border border-stone-300 relative" style="width:100%; max-width:1280px; height:80vh;">
      <div class="overlay absolute inset-0 flex items-center justify-center p-4 z-10">
        <div class="modal-enter bg-white rounded-2xl shadow-2xl w-full max-w-sm">
          <div class="mobile-handle hidden justify-center pt-3 pb-1"><div class="w-8 h-1 rounded-full bg-stone-300"></div></div>
          <div class="p-6">
            <div class="flex items-center gap-3 mb-4">
              <div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center">
                <svg class="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7a4 4 0 11-8 0 4 4 0 018 0zM9 14a6 6 0 00-6 6v1h12v-1a6 6 0 00-6-6zM21 12h-6"/></svg>
              </div>
              <div>
                <h3 class="text-sm font-bold text-stone-900 font-outfit">Retirer l'accès</h3>
                <p class="text-xs text-stone-500">Cette action est réversible</p>
              </div>
            </div>

            <div class="rounded-lg bg-red-50 border border-red-200 p-3 mb-4">
              <p class="text-xs text-red-700">Vous êtes sur le point de retirer l'accès de <strong>Marie-Claire Dupont</strong> (Editor) à cette transaction. Elle ne pourra plus consulter ni modifier les données.</p>
            </div>

            <div class="rounded-lg border border-stone-200 p-3 mb-4">
              <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-full bg-emerald-100 text-emerald-700 flex items-center justify-center text-xs font-bold flex-shrink-0">MC</div>
                <div>
                  <p class="text-xs font-medium text-stone-900">Marie-Claire Dupont</p>
                  <p class="text-[10px] text-stone-400">mc.dupont@email.com · Editor</p>
                </div>
              </div>
            </div>

            <label class="flex items-start gap-2 cursor-pointer mb-4">
              <input type="checkbox" id="remove-check" onchange="updateRemoveCta()" class="mt-0.5 rounded border-stone-300 text-red-600 focus:ring-red-200">
              <span class="text-xs text-stone-600">Je confirme vouloir retirer cet accès</span>
            </label>

            <div class="flex items-center gap-2">
              <button class="flex-1 px-3 py-2 text-xs font-medium text-stone-600 bg-white border border-stone-300 rounded-lg hover:bg-stone-50">Annuler</button>
              <button id="remove-btn" class="flex-1 px-3 py-2 text-xs font-medium text-white rounded-lg shadow-sm bg-stone-300 cursor-not-allowed" disabled>Retirer l'accès</button>
            </div>
          </div>
        </div>
      </div>
      <div class="absolute inset-0 bg-stone-50 opacity-50 p-8"><div class="max-w-4xl mx-auto"><div class="h-6 bg-stone-200 rounded w-48 mb-4"></div><div class="h-40 bg-stone-200 rounded w-full"></div></div></div>
    </div>
  </div>

  <!-- ============================================== -->
  <!-- STATE F — Erreur permission                     -->
  <!-- ============================================== -->
  <div id="state-error-section" class="state-section pt-28 pb-8 px-4">
    <div id="viewport-frame-f" class="viewport-frame bg-stone-100 shadow-2xl rounded-xl border border-stone-300 relative" style="width:100%; max-width:1280px; height:80vh;">
      <div class="overlay absolute inset-0 flex items-center justify-center p-4 z-10">
        <div class="modal-enter bg-white rounded-2xl shadow-2xl w-full max-w-sm">
          <div class="mobile-handle hidden justify-center pt-3 pb-1"><div class="w-8 h-1 rounded-full bg-stone-300"></div></div>
          <div class="p-6">
            <div class="flex items-center gap-3 mb-4">
              <div class="w-10 h-10 rounded-full bg-amber-100 flex items-center justify-center">
                <svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
              </div>
              <div>
                <h3 class="text-sm font-bold text-stone-900 font-outfit">Permission insuffisante</h3>
                <p class="text-xs text-stone-500">Action non autorisée</p>
              </div>
            </div>

            <div class="rounded-lg bg-amber-50 border border-amber-200 p-3 mb-4">
              <p class="text-xs text-amber-800">Seul le <strong>Owner</strong> peut transférer la propriété de la transaction. Vous êtes actuellement <strong>Admin</strong>.</p>
            </div>

            <div class="rounded-lg border border-stone-200 p-3 mb-4">
              <div class="space-y-2">
                <div class="flex items-center justify-between text-xs">
                  <span class="text-stone-500">Votre rôle</span>
                  <span class="role-badge bg-amber-100 text-amber-700">Admin</span>
                </div>
                <div class="flex items-center justify-between text-xs">
                  <span class="text-stone-500">Rôle requis</span>
                  <span class="role-badge bg-primary/10 text-primary">Owner</span>
                </div>
                <div class="flex items-center justify-between text-xs">
                  <span class="text-stone-500">Owner actuel</span>
                  <span class="text-stone-700 font-medium">Luc Tremblay</span>
                </div>
              </div>
            </div>

            <div class="space-y-2">
              <button class="w-full px-4 py-2.5 text-xs font-medium text-white bg-primary hover:bg-primary/90 rounded-lg shadow-sm flex items-center justify-center gap-1.5">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                Demander l'accès au Owner
              </button>
              <button class="w-full px-4 py-2 text-xs font-medium text-stone-600 bg-white border border-stone-300 rounded-lg hover:bg-stone-50">Fermer</button>
            </div>
          </div>
        </div>
      </div>
      <div class="absolute inset-0 bg-stone-50 opacity-50 p-8"><div class="max-w-4xl mx-auto"><div class="h-6 bg-stone-200 rounded w-48 mb-4"></div><div class="h-40 bg-stone-200 rounded w-full"></div></div></div>
    </div>
  </div>


  <!-- ============================================== -->
  <!-- JAVASCRIPT                                      -->
  <!-- ============================================== -->
  <script>
    const vpSizes = { mobile: 375, tablet: 768, desktop: 1280 };
    function setViewport(size) {
      document.querySelectorAll('.viewport-btn').forEach(b => b.classList.remove('active'));
      document.getElementById('btn-' + size).classList.add('active');
      const w = vpSizes[size];
      document.querySelectorAll('.viewport-frame').forEach(f => {
        f.style.maxWidth = w + 'px';
        if (size === 'mobile') f.classList.add('mobile-mode');
        else f.classList.remove('mobile-mode');
      });
    }

    function showState(state) {
      document.querySelectorAll('.state-section').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.state-btn').forEach(b => b.classList.remove('active'));
      const section = document.getElementById('state-' + state + '-section');
      const btn = document.getElementById('state-' + state);
      if (section) section.classList.add('active');
      if (btn) btn.classList.add('active');
    }

    /* Invite CTA gating */
    function updateInviteCta() {
      const email = document.getElementById('invite-email');
      const btn = document.getElementById('invite-send-btn');
      if (!email || !btn) return;
      const valid = email.value.includes('@') && email.value.includes('.');
      if (valid) {
        btn.disabled = false;
        btn.className = 'px-4 py-2 text-xs font-medium text-white rounded-lg shadow-sm bg-primary hover:bg-primary/90 cursor-pointer flex items-center gap-1.5';
      } else {
        btn.disabled = true;
        btn.className = 'px-4 py-2 text-xs font-medium text-white rounded-lg shadow-sm bg-stone-300 cursor-not-allowed flex items-center gap-1.5';
      }
    }

    function selectInviteRole(el) {
      el.parentElement.querySelectorAll('.radio-card').forEach(c => c.classList.remove('selected'));
      el.classList.add('selected');
    }

    /* Remove CTA gating */
    function updateRemoveCta() {
      const cb = document.getElementById('remove-check');
      const btn = document.getElementById('remove-btn');
      if (!cb || !btn) return;
      if (cb.checked) {
        btn.disabled = false;
        btn.className = 'flex-1 px-3 py-2 text-xs font-medium text-white rounded-lg shadow-sm bg-red-600 hover:bg-red-700 cursor-pointer';
      } else {
        btn.disabled = true;
        btn.className = 'flex-1 px-3 py-2 text-xs font-medium text-white rounded-lg shadow-sm bg-stone-300 cursor-not-allowed';
      }
    }

    setViewport('desktop');
    showState('list');
  </script>

</body>
</html>
