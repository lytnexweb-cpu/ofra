<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Maquette 12 — Ajouter une offre</title>
  <style>
    :root {
      --primary: #1e3a5f;
      --accent: #e07a2f;
      --success: #059669;
      --error: #dc2626;
      --warning: #d97706;
      --s50: #fafaf9; --s100: #f5f5f4; --s200: #e7e5e4; --s300: #d6d3d1;
      --s400: #a8a29e; --s500: #78716c; --s600: #57534e; --s700: #44403c; --s800: #292524; --s900: #1c1917;
      --radius: 12px; --radius-sm: 8px;
      --shadow: 0 1px 3px rgba(0,0,0,.1);
      --shadow-lg: 0 10px 25px rgba(0,0,0,.15);
      --font: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: var(--font); background: var(--s300); min-height: 100vh; }

    /* ===== TOPBAR ===== */
    .topbar { position: fixed; top: 0; left: 0; right: 0; background: var(--s800); color: #fff; z-index: 100; box-shadow: 0 4px 12px rgba(0,0,0,.25); }
    .topbar-inner { max-width: 1400px; margin: 0 auto; padding: 10px 16px; display: flex; align-items: center; justify-content: space-between; gap: 12px; }
    .topbar-title { font-size: 13px; font-weight: 700; letter-spacing: .02em; white-space: nowrap; }
    .topbar-sub { font-size: 11px; color: var(--s400); margin-left: 8px; }
    .vp-btns { display: flex; gap: 6px; }
    .vp-btn { padding: 5px 10px; border-radius: var(--radius-sm); font-size: 11px; font-weight: 500; background: var(--s700); border: none; color: #fff; cursor: pointer; transition: background .2s; }
    .vp-btn:hover { background: var(--s600); }
    .vp-btn.active { background: var(--primary); }
    .topbar-label { font-size: 11px; color: var(--s400); white-space: nowrap; }

    /* ===== STATE BAR ===== */
    .state-bar { position: fixed; top: 48px; left: 0; right: 0; background: var(--s700); color: #fff; z-index: 99; border-top: 1px solid var(--s600); }
    .state-inner { max-width: 1400px; margin: 0 auto; padding: 8px 16px; display: flex; align-items: center; gap: 6px; flex-wrap: wrap; }
    .state-label { font-size: 10px; color: var(--s400); font-weight: 600; text-transform: uppercase; letter-spacing: .04em; margin-right: 4px; }
    .st-btn { padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 500; background: var(--s600); border: none; color: #fff; cursor: pointer; transition: background .2s; white-space: nowrap; }
    .st-btn:hover { background: var(--s500); }
    .st-btn.active { background: var(--primary); }

    /* ===== VIEWPORT FRAME ===== */
    .state-section { display: none; }
    .state-section.active { display: block; }
    .viewport-frame { transition: width .4s ease, max-width .4s ease; margin: 0 auto; overflow: hidden; border-radius: var(--radius); border: 1px solid var(--s300); box-shadow: var(--shadow-lg); position: relative; }

    /* ===== OVERLAY ===== */
    .overlay { position: absolute; inset: 0; background: rgba(0,0,0,.5); backdrop-filter: blur(2px); display: flex; align-items: center; justify-content: center; padding: 16px; z-index: 10; overflow-y: auto; }

    /* ===== MODAL ===== */
    .modal { background: #fff; border-radius: 16px; box-shadow: var(--shadow-lg); width: 100%; max-width: 820px; display: flex; flex-direction: column; max-height: calc(100% - 2rem); animation: modalIn .25s ease-out; }
    .modal-sm { max-width: 400px; }
    @keyframes modalIn { from { opacity: 0; transform: scale(.96) translateY(8px); } to { opacity: 1; transform: scale(1) translateY(0); } }
    .modal-header { padding: 20px 24px 16px; border-bottom: 1px solid var(--s100); display: flex; align-items: flex-start; justify-content: space-between; gap: 12px; flex-shrink: 0; }
    .modal-header-left { display: flex; align-items: center; gap: 12px; min-width: 0; }
    .modal-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
    .modal-header h2 { font-size: 15px; font-weight: 700; color: var(--s900); }
    .modal-header p { font-size: 11px; color: var(--s500); margin-top: 2px; }
    .close-btn { width: 32px; height: 32px; border-radius: 8px; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center; color: var(--s400); transition: all .15s; flex-shrink: 0; }
    .close-btn:hover { background: var(--s100); color: var(--s600); }
    .modal-body { overflow-y: auto; flex: 1; min-height: 0; }
    .modal-cols { display: grid; grid-template-columns: 1fr 1fr; gap: 0; min-height: 380px; }
    .modal-col { padding: 20px 24px; }
    .modal-col-right { border-left: 1px solid var(--s200); background: var(--s50); }
    .modal-footer { padding: 16px 24px; border-top: 1px solid var(--s200); display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-shrink: 0; background: var(--s50); border-radius: 0 0 16px 16px; }
    .modal-footer-right { display: flex; align-items: center; gap: 8px; }

    /* ===== FORM ===== */
    .field { margin-bottom: 14px; }
    .field-label { display: block; font-size: 11px; font-weight: 600; color: var(--s600); margin-bottom: 5px; }
    .field-label .req { color: var(--error); }
    .field-input { width: 100%; padding: 8px 12px; font-size: 13px; font-family: var(--font); border: 1px solid var(--s300); border-radius: var(--radius-sm); outline: none; transition: border .15s, box-shadow .15s; background: #fff; color: var(--s900); }
    .field-input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(30,58,95,.1); }
    .field-input::placeholder { color: var(--s400); }
    textarea.field-input { resize: vertical; min-height: 60px; }
    .field-hint { font-size: 10px; color: var(--s400); margin-top: 3px; }
    .field-error { font-size: 10px; color: var(--error); margin-top: 3px; display: flex; align-items: center; gap: 4px; }
    .field-input.has-error { border-color: var(--error); background: #fef2f2; }
    .field-input.has-warning { border-color: var(--warning); background: #fffbeb; }
    .field-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

    /* Segmented control */
    .segmented { display: flex; background: var(--s100); border-radius: var(--radius-sm); padding: 3px; gap: 2px; }
    .seg-btn { flex: 1; padding: 7px 12px; border: none; border-radius: 6px; font-size: 12px; font-weight: 600; font-family: var(--font); cursor: pointer; transition: all .15s; background: transparent; color: var(--s500); }
    .seg-btn.active { background: #fff; color: var(--primary); box-shadow: 0 1px 3px rgba(0,0,0,.1); }

    /* Expiry pills */
    .exp-pills { display: flex; gap: 6px; flex-wrap: wrap; }
    .exp-pill { padding: 6px 14px; border-radius: 20px; font-size: 11px; font-weight: 500; border: 1px solid var(--s300); background: #fff; color: var(--s600); cursor: pointer; transition: all .15s; font-family: var(--font); }
    .exp-pill:hover { border-color: var(--primary); color: var(--primary); }
    .exp-pill.active { background: var(--primary); color: #fff; border-color: var(--primary); }

    /* Toggle inline */
    .toggle-row { display: flex; align-items: center; justify-content: space-between; padding: 8px 0; }
    .toggle-text { font-size: 12px; font-weight: 500; color: var(--s700); }
    .switch { width: 36px; height: 20px; border-radius: 10px; background: var(--s300); position: relative; cursor: pointer; transition: background .2s; flex-shrink: 0; }
    .switch.on { background: var(--primary); }
    .switch-dot { width: 16px; height: 16px; border-radius: 50%; background: #fff; position: absolute; top: 2px; left: 2px; transition: transform .2s; box-shadow: 0 1px 3px rgba(0,0,0,.15); }
    .switch.on .switch-dot { transform: translateX(16px); }
    .cond-field { overflow: hidden; max-height: 0; transition: max-height .25s ease; }
    .cond-field.open { max-height: 80px; margin-top: 8px; }

    /* Summary card */
    .summary-card { background: var(--s50); border: 1px solid var(--s200); border-radius: var(--radius-sm); padding: 12px; margin-top: 16px; }
    .summary-row { display: flex; align-items: center; justify-content: space-between; padding: 4px 0; font-size: 11px; }
    .summary-label { color: var(--s500); }
    .summary-val { font-weight: 600; color: var(--s900); }
    .summary-diff { color: var(--accent); font-weight: 700; }
    .summary-divider { border: none; border-top: 1px dashed var(--s200); margin: 6px 0; }

    /* ===== RIGHT COLUMN — PACKS ===== */
    .section-title { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: .06em; color: var(--s500); margin-bottom: 10px; }
    .pack-reco { background: #fff; border: 1px solid var(--s200); border-radius: var(--radius-sm); padding: 12px; margin-bottom: 14px; display: flex; align-items: center; gap: 10px; }
    .pack-reco-icon { width: 36px; height: 36px; border-radius: 8px; background: rgba(30,58,95,.08); display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
    .pack-reco-info { flex: 1; min-width: 0; }
    .pack-reco-info p { font-size: 12px; font-weight: 600; color: var(--s900); }
    .pack-reco-info span { font-size: 10px; color: var(--s400); }
    .pack-reco-btn { padding: 6px 14px; border-radius: 6px; font-size: 11px; font-weight: 600; background: var(--primary); color: #fff; border: none; cursor: pointer; white-space: nowrap; font-family: var(--font); transition: background .15s; }
    .pack-reco-btn:hover { background: #16304d; }

    .pack-chips { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 16px; }
    .pack-chip { padding: 5px 12px; border-radius: 16px; font-size: 11px; font-weight: 500; border: 1px solid var(--s200); background: #fff; color: var(--s600); cursor: pointer; transition: all .15s; font-family: var(--font); }
    .pack-chip:hover { border-color: var(--primary); color: var(--primary); }
    .pack-chip.active { background: var(--primary); color: #fff; border-color: var(--primary); }

    .cond-counter { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
    .cond-count { font-size: 12px; font-weight: 600; color: var(--s900); }
    .cond-count-num { background: var(--primary); color: #fff; padding: 1px 8px; border-radius: 10px; font-size: 10px; font-weight: 700; margin-left: 6px; }

    .cond-list { display: flex; flex-direction: column; gap: 6px; }
    .cond-item { display: flex; align-items: center; justify-content: space-between; gap: 8px; padding: 8px 10px; border-radius: var(--radius-sm); border: 1px solid var(--s200); background: #fff; }
    .cond-item-left { display: flex; flex-direction: column; gap: 2px; min-width: 0; }
    .cond-item-title { font-size: 12px; font-weight: 500; color: var(--s900); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .cond-item-badges { display: flex; gap: 4px; flex-wrap: wrap; }
    .badge { padding: 1px 7px; border-radius: 10px; font-size: 9px; font-weight: 700; text-transform: uppercase; letter-spacing: .03em; }
    .badge-auto { background: rgba(30,58,95,.1); color: var(--primary); }
    .badge-pack { background: rgba(224,122,47,.1); color: var(--accent); }
    .badge-legal { background: #ede9fe; color: #7c3aed; }
    .badge-industry { background: #e0f2fe; color: #0284c7; }
    .badge-status { background: #d1fae5; color: var(--success); }
    .badge-contre { background: rgba(224,122,47,.15); color: var(--accent); }
    .cond-empty { text-align: center; padding: 24px 16px; color: var(--s400); font-size: 12px; }
    .cond-empty-icon { font-size: 28px; margin-bottom: 8px; display: block; opacity: .4; }
    .cond-link { display: inline-flex; align-items: center; gap: 4px; font-size: 11px; color: var(--primary); text-decoration: none; margin-top: 12px; font-weight: 500; cursor: pointer; }
    .cond-link:hover { text-decoration: underline; }

    /* ===== LOADING BAR ===== */
    .load-bar { height: 3px; background: var(--s200); border-radius: 2px; overflow: hidden; margin-bottom: 12px; }
    .load-bar-fill { height: 100%; background: var(--primary); border-radius: 2px; animation: loadAnim 1.5s ease-in-out infinite; width: 60%; }
    @keyframes loadAnim { 0% { transform: translateX(-100%); } 100% { transform: translateX(200%); } }

    /* ===== BUTTONS ===== */
    .btn { padding: 8px 18px; border-radius: var(--radius-sm); font-size: 12px; font-weight: 600; font-family: var(--font); cursor: pointer; transition: all .15s; border: none; display: inline-flex; align-items: center; gap: 6px; }
    .btn-primary { background: var(--primary); color: #fff; }
    .btn-primary:hover { background: #16304d; }
    .btn-primary:disabled { background: var(--s300); color: #fff; cursor: not-allowed; }
    .btn-secondary { background: #fff; color: var(--s600); border: 1px solid var(--s300); }
    .btn-secondary:hover { background: var(--s50); }
    .btn-error { background: var(--error); color: #fff; }
    .btn-error:hover { background: #b91c1c; }
    .btn-success { background: var(--success); color: #fff; }
    .btn-full { width: 100%; justify-content: center; }

    /* ===== CHECK TOGGLE ===== */
    .check-row { display: flex; align-items: center; gap: 8px; font-size: 11px; color: var(--s600); cursor: pointer; }
    .check-row input { accent-color: var(--primary); }

    /* ===== SUCCESS MODAL ===== */
    .success-icon { width: 56px; height: 56px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; }

    /* ===== ERROR BANNER ===== */
    .error-banner { background: #fef2f2; border: 1px solid #fecaca; border-radius: var(--radius-sm); padding: 10px 14px; margin-bottom: 14px; display: flex; align-items: flex-start; gap: 8px; }
    .error-banner svg { flex-shrink: 0; margin-top: 1px; }
    .error-banner p { font-size: 11px; color: var(--error); }
    .warning-banner { background: #fffbeb; border: 1px solid #fde68a; border-radius: var(--radius-sm); padding: 10px 14px; margin-bottom: 14px; display: flex; align-items: flex-start; gap: 8px; }
    .warning-banner p { font-size: 11px; color: var(--warning); }

    /* ===== PLACEHOLDER BG ===== */
    .bg-placeholder { position: absolute; inset: 0; background: var(--s50); padding: 32px; opacity: .5; }
    .bg-placeholder .bar { background: var(--s200); border-radius: 6px; margin-bottom: 10px; }

    /* ===== MOBILE HANDLE ===== */
    .mobile-handle { display: none; justify-content: center; padding: 10px 0 4px; }
    .mobile-handle div { width: 32px; height: 4px; border-radius: 2px; background: var(--s300); }

    /* ===== ACCORDION (mobile) ===== */
    .accordion-header { display: none; }

    /* ===== MOBILE MODE ===== */
    .mobile-mode .overlay { align-items: flex-end; padding: 0; }
    .mobile-mode .modal {
      max-width: 100%; border-radius: 16px 16px 0 0;
      max-height: 85%; animation: sheetUp .25s ease-out;
    }
    .mobile-mode .modal-sm { border-radius: 16px 16px 0 0; max-height: 85%; }
    .mobile-mode .mobile-handle { display: flex; }
    .mobile-mode .modal-header { padding: 12px 16px; }
    .mobile-mode .modal-header h2 { font-size: 14px; }
    .mobile-mode .modal-icon { width: 34px; height: 34px; }
    .mobile-mode .modal-cols { grid-template-columns: 1fr; }
    .mobile-mode .modal-col { padding: 16px; }
    .mobile-mode .modal-col-right { border-left: none; border-top: 1px solid var(--s200); }
    .mobile-mode .modal-footer { padding: 12px 16px; flex-direction: column; gap: 10px; }
    .mobile-mode .modal-footer-right { width: 100%; }
    .mobile-mode .modal-footer-right .btn { flex: 1; justify-content: center; }
    .mobile-mode .field-row { grid-template-columns: 1fr; }
    .mobile-mode .exp-pills { gap: 4px; }
    .mobile-mode .exp-pill { padding: 5px 10px; font-size: 10px; }
    .mobile-mode .accordion-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 10px 0; cursor: pointer; border-top: 1px solid var(--s200); margin-top: 4px;
    }
    .mobile-mode .accordion-header span { font-size: 11px; font-weight: 600; color: var(--s700); text-transform: uppercase; letter-spacing: .04em; }
    .mobile-mode .accordion-header svg { transition: transform .2s; }
    .mobile-mode .accordion-header.open svg { transform: rotate(180deg); }
    .mobile-mode .accordion-body { overflow: hidden; max-height: 0; transition: max-height .3s ease; }
    .mobile-mode .accordion-body.open { max-height: 600px; }
    .mobile-mode .pack-reco { flex-direction: column; text-align: center; }
    .mobile-mode .pack-reco-btn { width: 100%; text-align: center; }
    .mobile-mode .close-btn { display: none; }

    @keyframes sheetUp { from { opacity: 0; transform: translateY(100%); } to { opacity: 1; transform: translateY(0); } }

    /* Info card (used in D/E/F small modals) */
    .info-card { background: var(--s50); border: 1px solid var(--s200); border-radius: var(--radius-sm); padding: 12px; }
    .info-row { display: flex; justify-content: space-between; align-items: center; padding: 3px 0; font-size: 11px; }
    .info-label { color: var(--s500); }
    .info-val { font-weight: 600; color: var(--s900); }

    /* Permission card */
    .perm-card { background: #fffbeb; border: 1px solid #fde68a; border-radius: var(--radius-sm); padding: 12px; margin-bottom: 16px; }
    .perm-card p { font-size: 12px; color: #92400e; }
    .err-card { background: #fef2f2; border: 1px solid #fecaca; border-radius: var(--radius-sm); padding: 12px; margin-bottom: 16px; }
    .err-card p { font-size: 12px; color: #991b1b; }

    /* role badge */
    .role-badge { font-size: 10px; padding: 2px 8px; border-radius: 9999px; font-weight: 600; }
  </style>
</head>
<body>

  <!-- ====== TOPBAR ====== -->
  <div class="topbar">
    <div class="topbar-inner">
      <div style="display:flex;align-items:center;">
        <span class="topbar-title">MAQUETTE 12</span>
        <span class="topbar-sub">Ajouter une offre</span>
      </div>
      <div class="vp-btns">
        <button onclick="setViewport('mobile')" id="btn-mobile" class="vp-btn">Mobile (375px)</button>
        <button onclick="setViewport('tablet')" id="btn-tablet" class="vp-btn">Tablette (768px)</button>
        <button onclick="setViewport('desktop')" id="btn-desktop" class="vp-btn active">Desktop (1280px)</button>
      </div>
      <span class="topbar-label">Modal ajout offre</span>
    </div>
  </div>

  <!-- ====== STATE BAR ====== -->
  <div class="state-bar">
    <div class="state-inner">
      <span class="state-label">Etat :</span>
      <button onclick="showState('a')" id="st-a" class="st-btn active">A &mdash; Normal</button>
      <button onclick="showState('b')" id="st-b" class="st-btn">B &mdash; Erreurs</button>
      <button onclick="showState('c')" id="st-c" class="st-btn">C &mdash; Pack charg&eacute;</button>
      <button onclick="showState('d')" id="st-d" class="st-btn">D &mdash; Succ&egrave;s</button>
      <button onclick="showState('e')" id="st-e" class="st-btn">E &mdash; Permission</button>
      <button onclick="showState('f')" id="st-f" class="st-btn">F &mdash; Erreur serveur</button>
    </div>
  </div>

  <!-- ============================================================ -->
  <!-- STATE A — Normal                                              -->
  <!-- ============================================================ -->
  <div id="sec-a" class="state-section active" style="padding:100px 16px 32px;">
    <div id="vf-a" class="viewport-frame" style="width:100%;max-width:1280px;height:85vh;background:var(--s100);">
      <div class="bg-placeholder"><div class="bar" style="width:200px;height:20px;"></div><div class="bar" style="width:100%;height:140px;"></div><div class="bar" style="width:100%;height:80px;"></div><div class="bar" style="width:60%;height:20px;"></div></div>
      <div class="overlay">
        <div class="modal">
          <div class="mobile-handle"><div></div></div>
          <div class="modal-header">
            <div class="modal-header-left">
              <div class="modal-icon" style="background:rgba(30,58,95,.08);">
                <svg width="20" height="20" fill="none" stroke="var(--primary)" stroke-width="2" viewBox="0 0 24 24"><path d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              </div>
              <div>
                <h2>Ajouter une offre</h2>
                <p>Transaction : Marie-Claire Dupont &bull; 125 rue Principale, Moncton</p>
              </div>
            </div>
            <button class="close-btn"><svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12"/></svg></button>
          </div>
          <div class="modal-body">
            <div class="modal-cols">
              <!-- LEFT: FORM -->
              <div class="modal-col">
                <!-- Type -->
                <div class="field">
                  <label class="field-label">Type</label>
                  <div class="segmented">
                    <button class="seg-btn active" onclick="selSeg(this)">Offre</button>
                    <button class="seg-btn" onclick="selSeg(this)">Contre-offre</button>
                  </div>
                </div>
                <!-- Montant -->
                <div class="field">
                  <label class="field-label">Montant offert <span class="req">*</span></label>
                  <input type="text" class="field-input" placeholder="425 000 $" oninput="calcDiffA()">
                  <span class="field-hint">Prix demand&eacute; : 450 000 $</span>
                </div>
                <!-- Depot + Date -->
                <div class="field-row">
                  <div class="field">
                    <label class="field-label">D&eacute;p&ocirc;t</label>
                    <input type="text" class="field-input" placeholder="10 000 $">
                  </div>
                  <div class="field">
                    <label class="field-label">Date limite d&eacute;p&ocirc;t</label>
                    <input type="date" class="field-input">
                  </div>
                </div>
                <!-- Closing -->
                <div class="field">
                  <label class="field-label">Date de cl&ocirc;ture</label>
                  <input type="date" class="field-input">
                </div>
                <!-- Expiration -->
                <div class="field">
                  <label class="field-label">Expiration <span class="req">*</span></label>
                  <div class="exp-pills">
                    <button class="exp-pill" onclick="selPill(this)">24h</button>
                    <button class="exp-pill active" onclick="selPill(this)">48h</button>
                    <button class="exp-pill" onclick="selPill(this)">7 jours</button>
                    <button class="exp-pill" onclick="selPill(this)">Custom</button>
                  </div>
                </div>
                <!-- Financement -->
                <div class="field">
                  <div class="toggle-row">
                    <span class="toggle-text">Financement</span>
                    <div class="switch" onclick="toggleSwitch(this,'fin-a')"><div class="switch-dot"></div></div>
                  </div>
                  <div class="cond-field" id="fin-a">
                    <input type="text" class="field-input" placeholder="Montant pr&eacute;-approbation">
                  </div>
                </div>
                <!-- Inspection -->
                <div class="field">
                  <div class="toggle-row">
                    <span class="toggle-text">Inspection</span>
                    <div class="switch" onclick="toggleSwitch(this,'insp-a')"><div class="switch-dot"></div></div>
                  </div>
                  <div class="cond-field" id="insp-a">
                    <input type="text" class="field-input" placeholder="D&eacute;lai (ex: 10 jours)">
                  </div>
                </div>
                <!-- Inclusions -->
                <div class="field">
                  <label class="field-label">Inclusions / Exclusions</label>
                  <textarea class="field-input" placeholder="&Eacute;lectrom&eacute;nagers, rideaux, luminaires..."></textarea>
                </div>
                <!-- Message -->
                <div class="field">
                  <label class="field-label">Message <span style="font-weight:400;color:var(--s400);">(optionnel)</span></label>
                  <textarea class="field-input" placeholder="Note pour le vendeur..."></textarea>
                </div>
                <!-- Summary -->
                <div class="summary-card" id="summary-a">
                  <div class="summary-row"><span class="summary-label">Prix demand&eacute;</span><span class="summary-val">450 000 $</span></div>
                  <div class="summary-row"><span class="summary-label">Offre propos&eacute;e</span><span class="summary-val" id="sum-offer-a">&mdash;</span></div>
                  <hr class="summary-divider">
                  <div class="summary-row"><span class="summary-label">Diff&eacute;rence</span><span class="summary-diff" id="sum-diff-a">&mdash;</span></div>
                  <div class="summary-row"><span class="summary-label">Expiration</span><span class="summary-val">48h</span></div>
                  <div class="summary-row"><span class="summary-label">Conditions</span><span class="summary-val">0</span></div>
                </div>
              </div>
              <!-- RIGHT: PACKS & CONDITIONS -->
              <div class="modal-col modal-col-right">
                <div class="section-title">Pack recommand&eacute;</div>
                <div class="pack-reco">
                  <div class="pack-reco-icon">
                    <svg width="18" height="18" fill="none" stroke="var(--primary)" stroke-width="2" viewBox="0 0 24 24"><path d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/></svg>
                  </div>
                  <div class="pack-reco-info">
                    <p>Finance NB</p>
                    <span>5 conditions &bull; Legal / Industrie</span>
                  </div>
                  <button class="pack-reco-btn">Charger</button>
                </div>

                <div class="section-title">Packs</div>
                <div class="pack-chips">
                  <button class="pack-chip" onclick="selChip(this)">Standard</button>
                  <button class="pack-chip" onclick="selChip(this)">Financement</button>
                  <button class="pack-chip" onclick="selChip(this)">Inspection</button>
                  <button class="pack-chip" onclick="selChip(this)">Cash offer</button>
                </div>

                <div class="section-title" style="margin-top:8px;">Conditions g&eacute;n&eacute;r&eacute;es</div>
                <div class="cond-empty">
                  <span class="cond-empty-icon">
                    <svg width="32" height="32" fill="none" stroke="var(--s300)" stroke-width="1.5" viewBox="0 0 24 24"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
                  </span>
                  Aucune condition.<br>Chargez un pack ou ajoutez manuellement.
                </div>
                <a class="cond-link">
                  G&eacute;rer en d&eacute;tail dans Conditions &amp; preuves
                  <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 5l7 7-7 7"/></svg>
                </a>

                <!-- Mobile accordion trigger -->
                <div class="accordion-header" onclick="toggleAccordion(this)">
                  <span>Conditions de l'offre</span>
                  <svg width="14" height="14" fill="none" stroke="var(--s500)" stroke-width="2" viewBox="0 0 24 24"><path d="M19 9l-7 7-7-7"/></svg>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <label class="check-row"><input type="checkbox" checked> Notifier par email</label>
            <div class="modal-footer-right">
              <button class="btn btn-secondary">Annuler</button>
              <button class="btn btn-primary" disabled>
                <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>
                Soumettre l'offre
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ============================================================ -->
  <!-- STATE B — Erreurs de validation                               -->
  <!-- ============================================================ -->
  <div id="sec-b" class="state-section" style="padding:100px 16px 32px;">
    <div id="vf-b" class="viewport-frame" style="width:100%;max-width:1280px;height:85vh;background:var(--s100);">
      <div class="bg-placeholder"><div class="bar" style="width:200px;height:20px;"></div><div class="bar" style="width:100%;height:140px;"></div><div class="bar" style="width:100%;height:80px;"></div></div>
      <div class="overlay">
        <div class="modal">
          <div class="mobile-handle"><div></div></div>
          <div class="modal-header">
            <div class="modal-header-left">
              <div class="modal-icon" style="background:rgba(30,58,95,.08);">
                <svg width="20" height="20" fill="none" stroke="var(--primary)" stroke-width="2" viewBox="0 0 24 24"><path d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              </div>
              <div>
                <h2>Ajouter une offre</h2>
                <p>Transaction : Marie-Claire Dupont &bull; 125 rue Principale, Moncton</p>
              </div>
            </div>
            <button class="close-btn"><svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12"/></svg></button>
          </div>
          <div class="modal-body">
            <div class="modal-cols">
              <div class="modal-col">
                <!-- Error banner -->
                <div class="error-banner">
                  <svg width="16" height="16" fill="none" stroke="var(--error)" stroke-width="2" viewBox="0 0 24 24"><path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4.5c-.77-.833-2.694-.833-3.464 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"/></svg>
                  <p><strong>4 erreurs</strong> emp&ecirc;chent la soumission. Corrigez les champs ci-dessous.</p>
                </div>
                <!-- Type -->
                <div class="field">
                  <label class="field-label">Type</label>
                  <div class="segmented"><button class="seg-btn active">Offre</button><button class="seg-btn">Contre-offre</button></div>
                </div>
                <!-- Montant ERROR -->
                <div class="field">
                  <label class="field-label">Montant offert <span class="req">*</span></label>
                  <input type="text" class="field-input has-error" value="">
                  <div class="field-error">
                    <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 8v4m0 4h.01"/></svg>
                    Le montant est requis
                  </div>
                </div>
                <!-- Depot WARNING -->
                <div class="field-row">
                  <div class="field">
                    <label class="field-label">D&eacute;p&ocirc;t</label>
                    <input type="text" class="field-input has-warning" value="500 000 $">
                    <div class="field-error" style="color:var(--warning);">
                      <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4.5c-.77-.833-2.694-.833-3.464 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"/></svg>
                      Le d&eacute;p&ocirc;t d&eacute;passe le montant offert
                    </div>
                  </div>
                  <div class="field">
                    <label class="field-label">Date limite d&eacute;p&ocirc;t</label>
                    <input type="date" class="field-input">
                  </div>
                </div>
                <!-- Closing ERROR -->
                <div class="field">
                  <label class="field-label">Date de cl&ocirc;ture</label>
                  <input type="date" class="field-input has-error" value="2024-01-01">
                  <div class="field-error">
                    <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 8v4m0 4h.01"/></svg>
                    La date de cl&ocirc;ture est dans le pass&eacute;
                  </div>
                </div>
                <!-- Expiration ERROR -->
                <div class="field">
                  <label class="field-label">Expiration <span class="req">*</span></label>
                  <div class="exp-pills">
                    <button class="exp-pill">24h</button><button class="exp-pill">48h</button><button class="exp-pill">7 jours</button><button class="exp-pill">Custom</button>
                  </div>
                  <div class="field-error">
                    <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 8v4m0 4h.01"/></svg>
                    S&eacute;lectionnez une expiration
                  </div>
                </div>
                <!-- Financement ERROR -->
                <div class="field">
                  <div class="toggle-row">
                    <span class="toggle-text">Financement</span>
                    <div class="switch on"><div class="switch-dot"></div></div>
                  </div>
                  <div class="cond-field open">
                    <input type="text" class="field-input has-error" value="">
                    <div class="field-error" style="margin-top:3px;">
                      <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 8v4m0 4h.01"/></svg>
                      Montant requis si financement activ&eacute;
                    </div>
                  </div>
                </div>
                <!-- Inspection -->
                <div class="field">
                  <div class="toggle-row"><span class="toggle-text">Inspection</span><div class="switch"><div class="switch-dot"></div></div></div>
                </div>
                <div class="field"><label class="field-label">Inclusions / Exclusions</label><textarea class="field-input"></textarea></div>
                <div class="field"><label class="field-label">Message <span style="font-weight:400;color:var(--s400);">(optionnel)</span></label><textarea class="field-input"></textarea></div>
                <div class="summary-card">
                  <div class="summary-row"><span class="summary-label">Prix demand&eacute;</span><span class="summary-val">450 000 $</span></div>
                  <div class="summary-row"><span class="summary-label">Offre propos&eacute;e</span><span class="summary-val" style="color:var(--error);">&mdash; requis</span></div>
                  <hr class="summary-divider">
                  <div class="summary-row"><span class="summary-label">Conditions</span><span class="summary-val">0</span></div>
                </div>
              </div>
              <!-- RIGHT -->
              <div class="modal-col modal-col-right">
                <div class="section-title">Pack recommand&eacute;</div>
                <div class="pack-reco">
                  <div class="pack-reco-icon"><svg width="18" height="18" fill="none" stroke="var(--primary)" stroke-width="2" viewBox="0 0 24 24"><path d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/></svg></div>
                  <div class="pack-reco-info"><p>Finance NB</p><span>5 conditions</span></div>
                  <button class="pack-reco-btn">Charger</button>
                </div>
                <div class="section-title">Packs</div>
                <div class="pack-chips">
                  <button class="pack-chip">Standard</button><button class="pack-chip">Financement</button><button class="pack-chip">Inspection</button><button class="pack-chip">Cash offer</button>
                </div>
                <div class="section-title" style="margin-top:8px;">Conditions g&eacute;n&eacute;r&eacute;es</div>
                <div class="cond-empty"><span class="cond-empty-icon"><svg width="32" height="32" fill="none" stroke="var(--s300)" stroke-width="1.5" viewBox="0 0 24 24"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg></span>Aucune condition.</div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <label class="check-row"><input type="checkbox" checked> Notifier par email</label>
            <div class="modal-footer-right">
              <button class="btn btn-secondary">Annuler</button>
              <button class="btn btn-primary" disabled>
                <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>
                Soumettre l'offre
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ============================================================ -->
  <!-- STATE C — Pack charg&eacute;                                  -->
  <!-- ============================================================ -->
  <div id="sec-c" class="state-section" style="padding:100px 16px 32px;">
    <div id="vf-c" class="viewport-frame" style="width:100%;max-width:1280px;height:85vh;background:var(--s100);">
      <div class="bg-placeholder"><div class="bar" style="width:200px;height:20px;"></div><div class="bar" style="width:100%;height:140px;"></div><div class="bar" style="width:100%;height:80px;"></div></div>
      <div class="overlay">
        <div class="modal">
          <div class="mobile-handle"><div></div></div>
          <div class="modal-header">
            <div class="modal-header-left">
              <div class="modal-icon" style="background:rgba(30,58,95,.08);">
                <svg width="20" height="20" fill="none" stroke="var(--primary)" stroke-width="2" viewBox="0 0 24 24"><path d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              </div>
              <div>
                <div style="display:flex;align-items:center;gap:8px;">
                  <h2>Ajouter une offre</h2>
                  <span class="badge badge-contre" style="font-size:10px;padding:2px 8px;">Contre-offre</span>
                </div>
                <p>Transaction : Marie-Claire Dupont &bull; 125 rue Principale, Moncton</p>
              </div>
            </div>
            <button class="close-btn"><svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12"/></svg></button>
          </div>
          <div class="modal-body">
            <div class="modal-cols">
              <div class="modal-col">
                <div class="field">
                  <label class="field-label">Type</label>
                  <div class="segmented"><button class="seg-btn">Offre</button><button class="seg-btn active">Contre-offre</button></div>
                </div>
                <div class="field">
                  <label class="field-label">Montant offert <span class="req">*</span></label>
                  <input type="text" class="field-input" value="435 000 $" oninput="calcDiffC()">
                  <span class="field-hint">Prix demand&eacute; : 450 000 $</span>
                </div>
                <div class="field-row">
                  <div class="field"><label class="field-label">D&eacute;p&ocirc;t</label><input type="text" class="field-input" value="15 000 $"></div>
                  <div class="field"><label class="field-label">Date limite d&eacute;p&ocirc;t</label><input type="date" class="field-input" value="2026-03-01"></div>
                </div>
                <div class="field"><label class="field-label">Date de cl&ocirc;ture</label><input type="date" class="field-input" value="2026-04-15"></div>
                <div class="field">
                  <label class="field-label">Expiration <span class="req">*</span></label>
                  <div class="exp-pills"><button class="exp-pill">24h</button><button class="exp-pill active">48h</button><button class="exp-pill">7 jours</button><button class="exp-pill">Custom</button></div>
                </div>
                <div class="field">
                  <div class="toggle-row"><span class="toggle-text">Financement</span><div class="switch on"><div class="switch-dot"></div></div></div>
                  <div class="cond-field open"><input type="text" class="field-input" value="400 000 $"></div>
                </div>
                <div class="field">
                  <div class="toggle-row"><span class="toggle-text">Inspection</span><div class="switch on"><div class="switch-dot"></div></div></div>
                  <div class="cond-field open"><input type="text" class="field-input" value="10 jours"></div>
                </div>
                <div class="field"><label class="field-label">Inclusions / Exclusions</label><textarea class="field-input">R&eacute;frig&eacute;rateur, cuisini&egrave;re, lave-vaisselle inclus</textarea></div>
                <div class="field"><label class="field-label">Message <span style="font-weight:400;color:var(--s400);">(optionnel)</span></label><textarea class="field-input">Nous souhaitons une r&eacute;ponse rapide.</textarea></div>
                <div class="summary-card">
                  <div class="summary-row"><span class="summary-label">Prix demand&eacute;</span><span class="summary-val">450 000 $</span></div>
                  <div class="summary-row"><span class="summary-label">Offre propos&eacute;e</span><span class="summary-val" id="sum-offer-c">435 000 $</span></div>
                  <hr class="summary-divider">
                  <div class="summary-row"><span class="summary-label">Diff&eacute;rence</span><span class="summary-diff" id="sum-diff-c">- 15 000 $</span></div>
                  <div class="summary-row"><span class="summary-label">Cl&ocirc;ture</span><span class="summary-val">15 avr. 2026</span></div>
                  <div class="summary-row"><span class="summary-label">Expiration</span><span class="summary-val">48h</span></div>
                  <div class="summary-row"><span class="summary-label">Conditions</span><span class="summary-val">5</span></div>
                </div>
              </div>
              <!-- RIGHT: Loaded pack -->
              <div class="modal-col modal-col-right">
                <div class="section-title">Pack recommand&eacute;</div>
                <div class="pack-reco" style="border-color:var(--success);background:#f0fdf4;">
                  <div class="pack-reco-icon" style="background:rgba(5,150,105,.1);">
                    <svg width="18" height="18" fill="none" stroke="var(--success)" stroke-width="2" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7"/></svg>
                  </div>
                  <div class="pack-reco-info">
                    <p style="color:var(--success);">Finance NB charg&eacute;</p>
                    <span>5 conditions appliqu&eacute;es</span>
                  </div>
                </div>

                <div class="section-title">Packs</div>
                <div class="pack-chips">
                  <button class="pack-chip">Standard</button>
                  <button class="pack-chip active">Financement</button>
                  <button class="pack-chip active">Inspection</button>
                  <button class="pack-chip">Cash offer</button>
                </div>

                <div style="margin-top:14px;">
                  <div class="cond-counter">
                    <span class="cond-count">Conditions<span class="cond-count-num">5</span></span>
                  </div>
                  <div class="cond-list">
                    <div class="cond-item">
                      <div class="cond-item-left">
                        <span class="cond-item-title">Financement approuv&eacute;</span>
                        <div class="cond-item-badges"><span class="badge badge-auto">Auto</span><span class="badge badge-legal">Legal</span></div>
                      </div>
                      <span class="badge badge-status">Active</span>
                    </div>
                    <div class="cond-item">
                      <div class="cond-item-left">
                        <span class="cond-item-title">Inspection satisfaisante</span>
                        <div class="cond-item-badges"><span class="badge badge-pack">Pack</span><span class="badge badge-industry">Industrie</span></div>
                      </div>
                      <span class="badge badge-status">Active</span>
                    </div>
                    <div class="cond-item">
                      <div class="cond-item-left">
                        <span class="cond-item-title">&Eacute;valuation municipale</span>
                        <div class="cond-item-badges"><span class="badge badge-auto">Auto</span></div>
                      </div>
                      <span class="badge badge-status">Active</span>
                    </div>
                    <div class="cond-item">
                      <div class="cond-item-left">
                        <span class="cond-item-title">Assurance titre</span>
                        <div class="cond-item-badges"><span class="badge badge-pack">Pack</span><span class="badge badge-legal">Legal</span></div>
                      </div>
                      <span class="badge badge-status">Active</span>
                    </div>
                    <div class="cond-item">
                      <div class="cond-item-left">
                        <span class="cond-item-title">Vente propri&eacute;t&eacute; actuelle</span>
                        <div class="cond-item-badges"><span class="badge badge-auto">Auto</span></div>
                      </div>
                      <span class="badge badge-status">Active</span>
                    </div>
                  </div>
                </div>
                <a class="cond-link">
                  G&eacute;rer en d&eacute;tail dans Conditions &amp; preuves
                  <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 5l7 7-7 7"/></svg>
                </a>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <label class="check-row"><input type="checkbox" checked> Notifier par email</label>
            <div class="modal-footer-right">
              <button class="btn btn-secondary">Annuler</button>
              <button class="btn btn-primary">
                <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>
                Soumettre l'offre
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ============================================================ -->
  <!-- STATE D — Offre soumise (succ&egrave;s)                       -->
  <!-- ============================================================ -->
  <div id="sec-d" class="state-section" style="padding:100px 16px 32px;">
    <div id="vf-d" class="viewport-frame" style="width:100%;max-width:1280px;height:80vh;background:var(--s100);">
      <div class="bg-placeholder"><div class="bar" style="width:200px;height:20px;"></div><div class="bar" style="width:100%;height:140px;"></div><div class="bar" style="width:100%;height:80px;"></div></div>
      <div class="overlay">
        <div class="modal modal-sm">
          <div class="mobile-handle"><div></div></div>
          <div style="padding:32px 24px;text-align:center;">
            <div class="success-icon" style="background:#d1fae5;">
              <svg width="28" height="28" fill="none" stroke="var(--success)" stroke-width="2" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7"/></svg>
            </div>
            <h2 style="font-size:16px;font-weight:700;color:var(--s900);margin-bottom:4px;">Offre soumise avec succ&egrave;s</h2>
            <p style="font-size:12px;color:var(--s500);margin-bottom:20px;">L'offre a &eacute;t&eacute; ajout&eacute;e &agrave; la transaction.</p>
            <div class="info-card" style="text-align:left;margin-bottom:20px;">
              <div class="info-row"><span class="info-label">Type</span><span class="info-val">Contre-offre</span></div>
              <div class="info-row"><span class="info-label">Montant</span><span class="info-val">435 000 $</span></div>
              <div class="info-row"><span class="info-label">Expiration</span><span class="info-val">48h</span></div>
              <div class="info-row"><span class="info-label">Conditions</span><span class="info-val">5</span></div>
              <div class="info-row"><span class="info-label">Notification</span><span class="info-val" style="color:var(--success);">Email envoy&eacute;</span></div>
            </div>
            <div style="display:flex;flex-direction:column;gap:8px;">
              <button class="btn btn-primary btn-full">
                <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 5l7 7-7 7"/></svg>
                Voir dans la timeline
              </button>
              <button class="btn btn-secondary btn-full">Fermer</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ============================================================ -->
  <!-- STATE E — Permission insuffisante                             -->
  <!-- ============================================================ -->
  <div id="sec-e" class="state-section" style="padding:100px 16px 32px;">
    <div id="vf-e" class="viewport-frame" style="width:100%;max-width:1280px;height:80vh;background:var(--s100);">
      <div class="bg-placeholder"><div class="bar" style="width:200px;height:20px;"></div><div class="bar" style="width:100%;height:140px;"></div><div class="bar" style="width:100%;height:80px;"></div></div>
      <div class="overlay">
        <div class="modal modal-sm">
          <div class="mobile-handle"><div></div></div>
          <div style="padding:28px 24px;">
            <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
              <div style="width:44px;height:44px;border-radius:50%;background:#fffbeb;display:flex;align-items:center;justify-content:center;flex-shrink:0;">
                <svg width="22" height="22" fill="none" stroke="var(--warning)" stroke-width="2" viewBox="0 0 24 24"><path d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
              </div>
              <div>
                <h2 style="font-size:15px;font-weight:700;color:var(--s900);">Action non autoris&eacute;e</h2>
                <p style="font-size:11px;color:var(--s500);">Permission insuffisante</p>
              </div>
            </div>
            <div class="perm-card">
              <p>Seuls les utilisateurs avec le r&ocirc;le <strong>Editor</strong>, <strong>Admin</strong> ou <strong>Owner</strong> peuvent soumettre une offre. Vous &ecirc;tes actuellement <strong>Viewer</strong>.</p>
            </div>
            <div class="info-card" style="margin-bottom:20px;">
              <div class="info-row"><span class="info-label">Votre r&ocirc;le</span><span class="role-badge" style="background:var(--s100);color:var(--s600);">Viewer</span></div>
              <div class="info-row"><span class="info-label">R&ocirc;le requis</span><span class="role-badge" style="background:rgba(30,58,95,.1);color:var(--primary);">Editor+</span></div>
              <div class="info-row"><span class="info-label">Owner</span><span class="info-val">Luc Tremblay</span></div>
            </div>
            <div style="display:flex;flex-direction:column;gap:8px;">
              <button class="btn btn-primary btn-full">
                <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                Demander l'acc&egrave;s
              </button>
              <button class="btn btn-secondary btn-full">Fermer</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ============================================================ -->
  <!-- STATE F — Erreur serveur                                      -->
  <!-- ============================================================ -->
  <div id="sec-f" class="state-section" style="padding:100px 16px 32px;">
    <div id="vf-f" class="viewport-frame" style="width:100%;max-width:1280px;height:80vh;background:var(--s100);">
      <div class="bg-placeholder"><div class="bar" style="width:200px;height:20px;"></div><div class="bar" style="width:100%;height:140px;"></div><div class="bar" style="width:100%;height:80px;"></div></div>
      <div class="overlay">
        <div class="modal modal-sm">
          <div class="mobile-handle"><div></div></div>
          <div style="padding:28px 24px;">
            <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
              <div style="width:44px;height:44px;border-radius:50%;background:#fef2f2;display:flex;align-items:center;justify-content:center;flex-shrink:0;">
                <svg width="22" height="22" fill="none" stroke="var(--error)" stroke-width="2" viewBox="0 0 24 24"><path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4.5c-.77-.833-2.694-.833-3.464 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"/></svg>
              </div>
              <div>
                <h2 style="font-size:15px;font-weight:700;color:var(--s900);">Impossible de soumettre</h2>
                <p style="font-size:11px;color:var(--s500);">Erreur serveur (500)</p>
              </div>
            </div>
            <div class="err-card">
              <p>Une erreur inattendue est survenue lors de la soumission de l'offre. Vos donn&eacute;es n'ont pas &eacute;t&eacute; perdues.</p>
            </div>
            <div class="info-card" style="margin-bottom:20px;">
              <div class="info-row"><span class="info-label">Code erreur</span><span class="info-val" style="font-family:monospace;font-size:10px;">ERR_OFFER_SUBMIT_500</span></div>
              <div class="info-row"><span class="info-label">Timestamp</span><span class="info-val" style="font-family:monospace;font-size:10px;">2026-02-10 14:32:07</span></div>
            </div>
            <div style="display:flex;flex-direction:column;gap:8px;">
              <button class="btn btn-error btn-full">
                <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
                R&eacute;essayer
              </button>
              <button class="btn btn-secondary btn-full" onclick="copyError()">
                <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
                Copier les d&eacute;tails
              </button>
              <button class="btn btn-secondary btn-full">Fermer</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


  <!-- ============================================================ -->
  <!-- JAVASCRIPT                                                    -->
  <!-- ============================================================ -->
  <script>
    /* Viewport switching */
    var vpSizes = { mobile: 375, tablet: 768, desktop: 1280 };
    function setViewport(size) {
      document.querySelectorAll('.vp-btn').forEach(function(b) { b.classList.remove('active'); });
      document.getElementById('btn-' + size).classList.add('active');
      var w = vpSizes[size];
      document.querySelectorAll('.viewport-frame').forEach(function(f) {
        f.style.maxWidth = w + 'px';
        if (size === 'mobile') f.classList.add('mobile-mode');
        else f.classList.remove('mobile-mode');
      });
    }

    /* State switching */
    function showState(s) {
      document.querySelectorAll('.state-section').forEach(function(el) { el.classList.remove('active'); });
      document.querySelectorAll('.st-btn').forEach(function(b) { b.classList.remove('active'); });
      var sec = document.getElementById('sec-' + s);
      var btn = document.getElementById('st-' + s);
      if (sec) sec.classList.add('active');
      if (btn) btn.classList.add('active');
    }

    /* Segmented control */
    function selSeg(el) {
      el.parentElement.querySelectorAll('.seg-btn').forEach(function(b) { b.classList.remove('active'); });
      el.classList.add('active');
    }

    /* Expiry pills */
    function selPill(el) {
      el.parentElement.querySelectorAll('.exp-pill').forEach(function(p) { p.classList.remove('active'); });
      el.classList.add('active');
    }

    /* Pack chips */
    function selChip(el) { el.classList.toggle('active'); }

    /* Toggle switch + conditional field */
    function toggleSwitch(sw, fieldId) {
      sw.classList.toggle('on');
      var field = document.getElementById(fieldId);
      if (field) field.classList.toggle('open');
    }

    /* Accordion (mobile) */
    function toggleAccordion(el) {
      el.classList.toggle('open');
      var body = el.nextElementSibling;
      if (body) body.classList.toggle('open');
    }

    /* Diff calculation — State A */
    function calcDiffA() {
      var input = document.querySelector('#sec-a .field-input[oninput]');
      if (!input) return;
      var raw = input.value.replace(/[^0-9]/g, '');
      var val = parseInt(raw) || 0;
      var ask = 450000;
      var offerEl = document.getElementById('sum-offer-a');
      var diffEl = document.getElementById('sum-diff-a');
      if (val > 0) {
        offerEl.textContent = val.toLocaleString('fr-CA') + ' $';
        var diff = val - ask;
        var sign = diff >= 0 ? '+ ' : '- ';
        diffEl.textContent = sign + Math.abs(diff).toLocaleString('fr-CA') + ' $';
        diffEl.style.color = diff >= 0 ? 'var(--success)' : 'var(--accent)';
      } else {
        offerEl.textContent = '\u2014';
        diffEl.textContent = '\u2014';
        diffEl.style.color = '';
      }
    }

    /* Diff calculation — State C */
    function calcDiffC() {
      var input = document.querySelector('#sec-c .field-input[oninput]');
      if (!input) return;
      var raw = input.value.replace(/[^0-9]/g, '');
      var val = parseInt(raw) || 0;
      var ask = 450000;
      var offerEl = document.getElementById('sum-offer-c');
      var diffEl = document.getElementById('sum-diff-c');
      if (val > 0) {
        offerEl.textContent = val.toLocaleString('fr-CA') + ' $';
        var diff = val - ask;
        var sign = diff >= 0 ? '+ ' : '- ';
        diffEl.textContent = sign + Math.abs(diff).toLocaleString('fr-CA') + ' $';
        diffEl.style.color = diff >= 0 ? 'var(--success)' : 'var(--accent)';
      } else {
        offerEl.textContent = '\u2014';
        diffEl.textContent = '\u2014';
      }
    }

    /* Copy error details */
    function copyError() {
      var text = 'ERR_OFFER_SUBMIT_500 | 2026-02-10 14:32:07';
      if (navigator.clipboard) {
        navigator.clipboard.writeText(text);
      }
      var btn = document.querySelector('#sec-f .btn-secondary');
      if (btn) {
        var orig = btn.innerHTML;
        btn.innerHTML = '<svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7"/></svg> Copi\u00e9 !';
        btn.style.borderColor = 'var(--success)';
        btn.style.color = 'var(--success)';
        setTimeout(function() { btn.innerHTML = orig; btn.style.borderColor = ''; btn.style.color = ''; }, 1500);
      }
    }

    /* Init */
    setViewport('desktop');
    showState('a');
  </script>

</body>
</html>
