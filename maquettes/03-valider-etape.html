<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Maquette 03 — Valider l'etape</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwindcss.config = {
      theme: {
        extend: {
          colors: { primary: '#1e3a5f', accent: '#e07a2f' },
          fontFamily: { outfit: ['Outfit', 'system-ui', 'sans-serif'] },
        },
      },
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    .viewport-btn.active { background: #1e3a5f; color: white; }
    .viewport-frame { transition: width 0.4s ease, max-width 0.4s ease; margin: 0 auto; overflow: hidden; }
    .overlay { background: rgba(0,0,0,0.5); backdrop-filter: blur(2px); overflow-y: auto; }
    .modal-enter {
      animation: modalIn 0.2s ease-out;
      display: flex;
      flex-direction: column;
      max-height: calc(100% - 6rem);
    }
    .modal-body {
      overflow-y: auto;
      flex: 1;
      min-height: 0;
    }
    @keyframes modalIn { from { opacity: 0; transform: scale(0.95) translateY(8px); } to { opacity: 1; transform: scale(1) translateY(0); } }

    /* Mobile bottom-sheet */
    .mobile-mode { overflow-y: auto !important; }
    .mobile-mode .overlay {
      align-items: flex-end;
      padding: 0;
      overflow-y: auto;
    }
    .mobile-mode .modal-enter {
      max-width: 100%;
      border-radius: 1rem 1rem 0 0;
      max-height: 92%;
      display: flex;
      flex-direction: column;
      animation: sheetUp 0.25s ease-out;
    }
    .mobile-mode .modal-body {
      overflow-y: auto;
      flex: 1;
      min-height: 0;
    }
    .mobile-mode .mobile-handle { display: flex; }
    .mobile-mode .modal-header { padding-top: 0.75rem; }
    @keyframes sheetUp { from { opacity: 0; transform: translateY(100%); } to { opacity: 1; transform: translateY(0); } }

    /* State toggle */
    .state-section { display: none; }
    .state-section.active { display: block; }
    .state-btn.active { background: #1e3a5f; color: white; }
  </style>
</head>
<body class="bg-stone-200 min-h-screen">

  <!-- VIEWPORT SWITCHER -->
  <div class="fixed top-0 left-0 right-0 bg-stone-800 text-white z-[100] shadow-lg">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <span class="text-sm font-bold font-outfit">MAQUETTE 03</span>
        <span class="text-xs text-stone-400">Valider l'etape — Modale confirmation</span>
      </div>
      <div class="flex items-center gap-2">
        <button onclick="setViewport('mobile')" id="btn-mobile" class="viewport-btn px-3 py-1.5 rounded-lg text-xs font-medium bg-stone-700 hover:bg-stone-600 transition-colors">Mobile (375px)</button>
        <button onclick="setViewport('tablet')" id="btn-tablet" class="viewport-btn px-3 py-1.5 rounded-lg text-xs font-medium bg-stone-700 hover:bg-stone-600 transition-colors">Tablette (768px)</button>
        <button onclick="setViewport('desktop')" id="btn-desktop" class="viewport-btn active px-3 py-1.5 rounded-lg text-xs font-medium bg-stone-700 hover:bg-stone-600 transition-colors">Desktop (1280px)</button>
      </div>
      <div class="text-xs text-stone-400">CTA "Valider l'etape" sur page transaction</div>
    </div>
  </div>

  <!-- STATE SWITCHER (for mockup navigation) -->
  <div class="fixed top-[52px] left-0 right-0 bg-stone-700 text-white z-[99] border-t border-stone-600">
    <div class="max-w-7xl mx-auto px-4 py-2 flex items-center gap-3">
      <span class="text-xs text-stone-400 font-medium">ETAT :</span>
      <button onclick="showState('blocked')" id="state-blocked" class="state-btn active px-3 py-1 rounded-md text-xs font-medium bg-stone-600 hover:bg-stone-500 transition-colors">A — Bloque (2 bloquantes + 1 requise)</button>
      <button onclick="showState('ready')" id="state-ready" class="state-btn px-3 py-1 rounded-md text-xs font-medium bg-stone-600 hover:bg-stone-500 transition-colors">B — Pret a valider</button>
      <button onclick="showState('success')" id="state-success" class="state-btn px-3 py-1 rounded-md text-xs font-medium bg-stone-600 hover:bg-stone-500 transition-colors">C — Succes</button>
    </div>
  </div>

  <!-- ============================================== -->
  <!-- ETAT A: BLOQUE — conditions bloquantes pending -->
  <!-- ============================================== -->
  <div id="state-blocked-section" class="state-section active pt-24 pb-8 px-4">
    <div id="viewport-frame-a" class="viewport-frame bg-stone-100 shadow-2xl rounded-xl border border-stone-300 relative" style="width: 100%; max-width: 1280px; height: 80vh;">

      <!-- Fond simule -->
      <div class="absolute inset-0 flex items-center justify-center p-4 sm:p-8">
        <div class="w-full max-w-4xl opacity-30">
          <div class="h-8 bg-stone-300 rounded mb-4 w-48"></div>
          <div class="h-4 bg-stone-200 rounded mb-2 w-64"></div>
          <div class="h-32 bg-stone-200 rounded mb-4"></div>
          <div class="h-48 bg-stone-200 rounded mb-4"></div>
          <div class="h-64 bg-stone-200 rounded"></div>
        </div>
      </div>

      <!-- OVERLAY -->
      <div class="overlay absolute inset-0 z-40 flex items-center justify-center p-4">
        <div class="modal-enter bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden">

          <!-- Drag handle -->
          <div class="mobile-handle hidden justify-center pt-2 pb-1">
            <div class="w-10 h-1 rounded-full bg-stone-300"></div>
          </div>

          <!-- Header -->
          <div class="modal-header px-5 sm:px-6 pt-5 sm:pt-6 pb-4 border-b border-stone-100">
            <div class="flex items-start justify-between">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center shrink-0">
                  <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </div>
                <div>
                  <h2 class="text-base sm:text-lg font-bold text-stone-900 font-outfit">Valider l'etape</h2>
                  <p class="text-xs text-stone-500 mt-0.5">Etape 4 — Periode conditionnelle</p>
                </div>
              </div>
              <button class="p-1.5 rounded-lg hover:bg-stone-100 text-stone-400 -mt-1 -mr-1">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
              </button>
            </div>
          </div>

          <!-- Corps -->
          <div class="modal-body px-5 sm:px-6 py-4 space-y-4">

            <!-- Alerte bloquante -->
            <div class="rounded-lg bg-red-50 border border-red-200 p-3 sm:p-4">
              <div class="flex items-center gap-2 mb-2">
                <svg class="w-4 h-4 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"/></svg>
                <span class="text-sm font-semibold text-red-800">Validation impossible</span>
              </div>
              <p class="text-xs text-red-700">2 conditions bloquantes et 1 condition requise doivent etre resolues avant de pouvoir avancer.</p>
            </div>

            <!-- Resume conditions -->
            <div class="space-y-2">
              <h3 class="text-xs font-semibold text-stone-500 uppercase tracking-wide">Resume des conditions</h3>

              <!-- Bloquantes (non resolues) -->
              <div class="rounded-lg border border-red-200 bg-white overflow-hidden">
                <div class="px-3 py-2 bg-red-50 border-b border-red-100 flex items-center justify-between">
                  <div class="flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full bg-red-500"></div>
                    <span class="text-xs font-semibold text-red-800">Bloquantes</span>
                  </div>
                  <span class="text-xs text-red-600 font-medium">3 / 5 resolues</span>
                </div>
                <div class="divide-y divide-stone-100">
                  <!-- Resolue -->
                  <div class="px-3 py-2 flex items-center justify-between">
                    <div class="flex items-center gap-2">
                      <svg class="w-4 h-4 text-emerald-500 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                      <span class="text-xs text-stone-600">Financement</span>
                    </div>
                    <span class="text-xs text-emerald-600 font-medium">Completee</span>
                  </div>
                  <!-- Resolue -->
                  <div class="px-3 py-2 flex items-center justify-between">
                    <div class="flex items-center gap-2">
                      <svg class="w-4 h-4 text-emerald-500 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                      <span class="text-xs text-stone-600">Depot</span>
                    </div>
                    <span class="text-xs text-emerald-600 font-medium">Completee</span>
                  </div>
                  <!-- Resolue -->
                  <div class="px-3 py-2 flex items-center justify-between">
                    <div class="flex items-center gap-2">
                      <svg class="w-4 h-4 text-emerald-500 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                      <span class="text-xs text-stone-600">Inspection</span>
                    </div>
                    <span class="text-xs text-emerald-600 font-medium">Completee</span>
                  </div>
                  <!-- NON resolue -->
                  <div class="px-3 py-2 flex items-center justify-between bg-red-50/50">
                    <div class="flex items-center gap-2">
                      <svg class="w-4 h-4 text-red-400 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke-width="2"/><path stroke-linecap="round" stroke-width="2" d="M12 8v4"/><circle cx="12" cy="16" r="0.5" fill="currentColor"/></svg>
                      <span class="text-xs text-red-800 font-medium">Test d'eau</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <span class="text-xs text-red-500 italic">echeance 18 fev.</span>
                      <button class="text-xs text-primary hover:text-primary/80 font-medium underline">Resoudre</button>
                    </div>
                  </div>
                  <!-- NON resolue -->
                  <div class="px-3 py-2 flex items-center justify-between bg-red-50/50">
                    <div class="flex items-center gap-2">
                      <svg class="w-4 h-4 text-red-400 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke-width="2"/><path stroke-linecap="round" stroke-width="2" d="M12 8v4"/><circle cx="12" cy="16" r="0.5" fill="currentColor"/></svg>
                      <span class="text-xs text-red-800 font-medium">Examen RPDS</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <span class="text-xs text-red-500 italic">echeance 15 fev.</span>
                      <button class="text-xs text-primary hover:text-primary/80 font-medium underline">Resoudre</button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Requises (non resolues) — second verrou -->
              <div class="rounded-lg border border-amber-200 bg-white overflow-hidden">
                <div class="px-3 py-2 bg-amber-50 border-b border-amber-100 flex items-center justify-between">
                  <div class="flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full bg-amber-500"></div>
                    <span class="text-xs font-semibold text-amber-800">Requises</span>
                  </div>
                  <span class="text-xs text-amber-600 font-medium">0 / 1 resolue</span>
                </div>
                <div class="divide-y divide-stone-100">
                  <!-- NON resolue -->
                  <div class="px-3 py-2 flex items-center justify-between bg-amber-50/50">
                    <div class="flex items-center gap-2">
                      <svg class="w-4 h-4 text-amber-400 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke-width="2"/><path stroke-linecap="round" stroke-width="2" d="M12 8v4"/><circle cx="12" cy="16" r="0.5" fill="currentColor"/></svg>
                      <span class="text-xs text-amber-800 font-medium">Certificat de localisation</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <span class="text-xs text-amber-500 italic">echeance 20 fev.</span>
                      <button class="text-xs text-primary hover:text-primary/80 font-medium underline">Resoudre</button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Recommandees — info auto-archivage -->
              <div class="rounded-lg border border-stone-200 bg-stone-50 p-3">
                <div class="flex items-center gap-2 mb-1">
                  <div class="w-2 h-2 rounded-full bg-stone-400"></div>
                  <span class="text-xs font-semibold text-stone-600">Recommandees</span>
                  <span class="text-xs text-stone-400 font-medium">2 en attente</span>
                </div>
                <p class="text-xs text-stone-500 italic">Les conditions recommandees non resolues seront automatiquement archivees comme « non applicable » lors de la validation.</p>
              </div>
            </div>

          </div>

          <!-- Footer — CTA disabled -->
          <div class="px-5 sm:px-6 py-4 bg-stone-50 border-t border-stone-100 flex flex-col-reverse sm:flex-row items-stretch sm:items-center gap-2 sm:justify-end">
            <button class="px-4 py-2.5 rounded-lg border border-stone-200 text-stone-600 hover:bg-stone-100 text-sm font-medium text-center">
              Fermer
            </button>
            <button disabled class="px-6 py-2.5 rounded-lg bg-stone-300 text-stone-500 text-sm font-semibold shadow-sm flex items-center justify-center gap-2 cursor-not-allowed" title="2 bloquantes + 1 requise non resolues">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
              Valider l'etape
            </button>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- ============================================== -->
  <!-- ETAT B: PRET — toutes bloquantes resolues      -->
  <!-- ============================================== -->
  <div id="state-ready-section" class="state-section pt-24 pb-8 px-4">
    <div id="viewport-frame-b" class="viewport-frame bg-stone-100 shadow-2xl rounded-xl border border-stone-300 relative" style="width: 100%; max-width: 1280px; height: 80vh;">

      <!-- Fond simule -->
      <div class="absolute inset-0 flex items-center justify-center p-4 sm:p-8">
        <div class="w-full max-w-4xl opacity-30">
          <div class="h-8 bg-stone-300 rounded mb-4 w-48"></div>
          <div class="h-4 bg-stone-200 rounded mb-2 w-64"></div>
          <div class="h-32 bg-stone-200 rounded mb-4"></div>
          <div class="h-48 bg-stone-200 rounded mb-4"></div>
          <div class="h-64 bg-stone-200 rounded"></div>
        </div>
      </div>

      <!-- OVERLAY -->
      <div class="overlay absolute inset-0 z-40 flex items-center justify-center p-4">
        <div class="modal-enter bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden">

          <!-- Drag handle -->
          <div class="mobile-handle hidden justify-center pt-2 pb-1">
            <div class="w-10 h-1 rounded-full bg-stone-300"></div>
          </div>

          <!-- Header -->
          <div class="modal-header px-5 sm:px-6 pt-5 sm:pt-6 pb-4 border-b border-stone-100">
            <div class="flex items-start justify-between">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-emerald-100 flex items-center justify-center shrink-0">
                  <svg class="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </div>
                <div>
                  <h2 class="text-base sm:text-lg font-bold text-stone-900 font-outfit">Valider l'etape</h2>
                  <p class="text-xs text-stone-500 mt-0.5">Etape 4 — Periode conditionnelle → Etape 5</p>
                </div>
              </div>
              <button class="p-1.5 rounded-lg hover:bg-stone-100 text-stone-400 -mt-1 -mr-1">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
              </button>
            </div>
          </div>

          <!-- Corps -->
          <div class="modal-body px-5 sm:px-6 py-4 space-y-4">

            <!-- Indicateur pret -->
            <div class="rounded-lg bg-emerald-50 border border-emerald-200 p-3 sm:p-4">
              <div class="flex items-center gap-2 mb-1">
                <svg class="w-4 h-4 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                <span class="text-sm font-semibold text-emerald-800">Pret pour validation</span>
              </div>
              <p class="text-xs text-emerald-700">Toutes les conditions bloquantes et requises sont resolues. Vous pouvez avancer au step suivant.</p>
            </div>

            <!-- Resume conditions -->
            <div class="space-y-2">
              <h3 class="text-xs font-semibold text-stone-500 uppercase tracking-wide">Resume des conditions</h3>

              <!-- Bloquantes — toutes resolues -->
              <div class="rounded-lg border border-emerald-200 bg-white overflow-hidden">
                <div class="px-3 py-2 bg-emerald-50 border-b border-emerald-100 flex items-center justify-between">
                  <div class="flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full bg-emerald-500"></div>
                    <span class="text-xs font-semibold text-emerald-800">Bloquantes</span>
                  </div>
                  <span class="text-xs text-emerald-600 font-medium">3 / 3 resolues</span>
                </div>
                <div class="divide-y divide-stone-100">
                  <div class="px-3 py-2 flex items-center justify-between">
                    <div class="flex items-center gap-2">
                      <svg class="w-4 h-4 text-emerald-500 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                      <span class="text-xs text-stone-700">Financement</span>
                    </div>
                    <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-emerald-100 text-emerald-700">Completee</span>
                  </div>
                  <div class="px-3 py-2 flex items-center justify-between">
                    <div class="flex items-center gap-2">
                      <svg class="w-4 h-4 text-emerald-500 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                      <span class="text-xs text-stone-700">Depot</span>
                    </div>
                    <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-emerald-100 text-emerald-700">Completee</span>
                  </div>
                  <div class="px-3 py-2 flex items-center justify-between">
                    <div class="flex items-center gap-2">
                      <svg class="w-4 h-4 text-amber-500 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                      <span class="text-xs text-stone-700">Test d'eau</span>
                    </div>
                    <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-700">Renoncee</span>
                  </div>
                </div>
              </div>

              <!-- Requises — toutes resolues -->
              <div class="rounded-lg border border-emerald-200 bg-white overflow-hidden">
                <div class="px-3 py-2 bg-emerald-50 border-b border-emerald-100 flex items-center justify-between">
                  <div class="flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full bg-emerald-500"></div>
                    <span class="text-xs font-semibold text-emerald-800">Requises</span>
                  </div>
                  <span class="text-xs text-emerald-600 font-medium">2 / 2 resolues</span>
                </div>
                <div class="divide-y divide-stone-100">
                  <div class="px-3 py-2 flex items-center justify-between">
                    <div class="flex items-center gap-2">
                      <svg class="w-4 h-4 text-emerald-500 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                      <span class="text-xs text-stone-700">Inspection</span>
                    </div>
                    <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-emerald-100 text-emerald-700">Completee</span>
                  </div>
                  <div class="px-3 py-2 flex items-center justify-between">
                    <div class="flex items-center gap-2">
                      <svg class="w-4 h-4 text-stone-400 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                      <span class="text-xs text-stone-700">Examen RPDS</span>
                    </div>
                    <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-stone-100 text-stone-600">Non applicable</span>
                  </div>
                </div>
              </div>

              <!-- Recommandees — seront auto-archivees -->
              <div class="rounded-lg border border-stone-200 bg-stone-50 p-3">
                <div class="flex items-center gap-2 mb-1">
                  <div class="w-2 h-2 rounded-full bg-stone-400"></div>
                  <span class="text-xs font-semibold text-stone-600">Recommandees</span>
                  <span class="text-xs text-stone-400 font-medium">2 en attente</span>
                </div>
                <p class="text-xs text-stone-500 italic">Seront automatiquement archivees comme « non applicable » lors de la validation.</p>
              </div>
            </div>

            <!-- Impact workflow -->
            <div class="rounded-lg border border-indigo-200 bg-indigo-50/50 p-3 sm:p-4">
              <h3 class="text-xs font-semibold text-indigo-800 flex items-center gap-1.5 mb-2">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                Impact sur le workflow
              </h3>
              <div class="space-y-2">
                <div class="flex items-start gap-2">
                  <svg class="w-4 h-4 text-emerald-500 mt-0.5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                  <span class="text-xs text-stone-700">L'etape <strong>4. Periode conditionnelle</strong> sera marquee comme completee</span>
                </div>
                <div class="flex items-start gap-2">
                  <svg class="w-4 h-4 text-primary mt-0.5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/></svg>
                  <span class="text-xs text-stone-700">L'etape <strong>5. Fermeture en attente</strong> demarrera automatiquement</span>
                </div>
                <div class="flex items-start gap-2">
                  <svg class="w-4 h-4 text-stone-400 mt-0.5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"/></svg>
                  <span class="text-xs text-stone-700">Les conditions seront <strong>archivees</strong> avec leur resolution (recommandees en attente → non applicable)</span>
                </div>
              </div>
            </div>

            <!-- Toggle notification email -->
            <div class="rounded-lg border border-stone-200 bg-white overflow-hidden" id="email-block-b">
              <div class="flex items-center justify-between px-3 py-2.5">
                <div class="flex items-center gap-2">
                  <svg class="w-4 h-4 text-stone-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                  <span class="text-xs font-medium text-stone-700">Notifier les parties par email</span>
                </div>
                <button id="email-toggle-b" class="relative inline-flex h-5 w-9 items-center rounded-full bg-primary transition-colors" onclick="toggleEmailB()">
                  <span class="inline-block h-3.5 w-3.5 transform rounded-full bg-white shadow transition-transform translate-x-4"></span>
                </button>
              </div>
              <div id="email-details-b" class="px-3 pb-3 space-y-2 border-t border-stone-100 pt-2">
                <div class="text-xs text-stone-500">Destinataires :</div>
                <div class="space-y-1.5">
                  <div class="flex items-center gap-1.5">
                    <div class="w-1.5 h-1.5 rounded-full bg-emerald-400"></div>
                    <span class="text-xs text-stone-700">Acheteur — jean.tremblay@email.com</span>
                  </div>
                  <div class="flex items-center gap-1.5">
                    <div class="w-1.5 h-1.5 rounded-full bg-emerald-400"></div>
                    <span class="text-xs text-stone-700">Vendeur — m.dupont@email.com</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Note optionnelle -->
            <div>
              <label class="block text-xs font-medium text-stone-600 mb-1">Note (optionnel)</label>
              <textarea rows="2" placeholder="Ex : Toutes les conditions remplies, transaction ferme..." class="w-full px-3 py-2 text-sm rounded-lg border border-stone-200 focus:outline-none focus:ring-2 focus:ring-primary/20 resize-none"></textarea>
            </div>

          </div>

          <!-- Footer — CTA actif -->
          <div class="px-5 sm:px-6 py-4 bg-stone-50 border-t border-stone-100 flex flex-col-reverse sm:flex-row items-stretch sm:items-center gap-2 sm:justify-end">
            <button class="px-4 py-2.5 rounded-lg border border-stone-200 text-stone-600 hover:bg-stone-100 text-sm font-medium text-center">
              Annuler
            </button>
            <button class="px-6 py-2.5 rounded-lg bg-primary hover:bg-primary/90 text-white text-sm font-semibold shadow-sm flex items-center justify-center gap-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              Valider et avancer
            </button>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- ============================================== -->
  <!-- ETAT C: SUCCES — etape validee                  -->
  <!-- ============================================== -->
  <div id="state-success-section" class="state-section pt-24 pb-8 px-4">
    <div id="viewport-frame-c" class="viewport-frame bg-stone-100 shadow-2xl rounded-xl border border-stone-300 relative" style="width: 100%; max-width: 1280px; height: 80vh;">

      <!-- Fond simule -->
      <div class="absolute inset-0 flex items-center justify-center p-4 sm:p-8">
        <div class="w-full max-w-4xl opacity-30">
          <div class="h-8 bg-stone-300 rounded mb-4 w-48"></div>
          <div class="h-4 bg-stone-200 rounded mb-2 w-64"></div>
          <div class="h-32 bg-stone-200 rounded mb-4"></div>
          <div class="h-48 bg-stone-200 rounded mb-4"></div>
          <div class="h-64 bg-stone-200 rounded"></div>
        </div>
      </div>

      <!-- OVERLAY -->
      <div class="overlay absolute inset-0 z-40 flex items-center justify-center p-4">
        <div class="modal-enter bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden">

          <!-- Drag handle -->
          <div class="mobile-handle hidden justify-center pt-2 pb-1">
            <div class="w-10 h-1 rounded-full bg-stone-300"></div>
          </div>

          <!-- Success header -->
          <div class="modal-header px-5 sm:px-6 py-5 text-center">
            <div class="w-14 h-14 rounded-full bg-emerald-100 flex items-center justify-center mx-auto mb-3">
              <svg class="w-7 h-7 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
            </div>
            <h2 class="text-base sm:text-lg font-bold text-stone-900 font-outfit">Etape validee !</h2>
            <p class="text-sm text-stone-500 mt-1">Periode conditionnelle → Fermeture en attente</p>
          </div>

          <!-- Resume des changements -->
          <div class="modal-body px-5 sm:px-6 pb-5 space-y-2">
            <div class="flex items-center gap-2 p-2.5 rounded-lg bg-emerald-50 border border-emerald-100">
              <svg class="w-4 h-4 text-emerald-600 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
              <span class="text-xs text-emerald-800">Etape 4 « Periode conditionnelle » completee</span>
            </div>
            <div class="flex items-center gap-2 p-2.5 rounded-lg bg-primary/5 border border-primary/10">
              <svg class="w-4 h-4 text-primary shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/></svg>
              <span class="text-xs text-primary">Etape 5 « Fermeture en attente » demarree</span>
            </div>
            <div class="flex items-center gap-2 p-2.5 rounded-lg bg-stone-50 border border-stone-200">
              <svg class="w-4 h-4 text-stone-500 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"/></svg>
              <span class="text-xs text-stone-600">{N} conditions archivees (3 completees, 1 renoncee, 1 non applicable, 2 recommandees auto-archivees)</span>
            </div>
          </div>

          <!-- CTA retour -->
          <div class="px-5 sm:px-6 py-4 bg-stone-50 border-t border-stone-100 text-center">
            <button class="px-6 py-2.5 rounded-lg bg-primary hover:bg-primary/90 text-white text-sm font-semibold shadow-sm">
              Retour a la transaction
            </button>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- SCRIPTS -->
  <script>
    function toggleEmailB() {
      const btn = document.getElementById('email-toggle-b');
      const details = document.getElementById('email-details-b');
      const dot = btn.querySelector('span');
      btn.classList.toggle('bg-primary');
      btn.classList.toggle('bg-stone-300');
      dot.classList.toggle('translate-x-4');
      dot.classList.toggle('translate-x-0.5');
      details.classList.toggle('hidden');
    }

    function showState(state) {
      document.querySelectorAll('.state-section').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.state-btn').forEach(b => b.classList.remove('active'));
      document.getElementById('state-' + state + '-section').classList.add('active');
      document.getElementById('state-' + state).classList.add('active');
    }

    function setViewport(mode) {
      const frames = document.querySelectorAll('.viewport-frame');
      document.querySelectorAll('.viewport-btn').forEach(b => b.classList.remove('active'));
      document.getElementById('btn-' + mode).classList.add('active');
      frames.forEach(frame => {
        if (mode === 'mobile') { frame.style.maxWidth = '375px'; frame.classList.add('mobile-mode'); }
        else if (mode === 'tablet') { frame.style.maxWidth = '768px'; frame.classList.remove('mobile-mode'); }
        else { frame.style.maxWidth = '1280px'; frame.classList.remove('mobile-mode'); }
      });
    }
  </script>

</body>
</html>
